<!DOCTYPE html>
<html>

<head>
    <title>Resume Builder</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .certifications-header {
            display: flex;
            justify-content: flex-end;
            /* Align button to the top right */
            margin-bottom: 10px;
            /* Add some space between the button and certifications */
        }

        .add-certification-button {
            font-size: 20px;
            /* Adjust the size as needed */
            color: green;
            /* Set the color to green */
            cursor: pointer;
        }

        .add-certification-button:hover {
            color: darkgreen;
            /* Change the color on hover if desired */
        }

        /* Add this CSS in your stylesheet or <style> tag */
        .close-icon {
            font-size: 16px;
            /* Adjust the size as needed */
            color: red;
            cursor: pointer;
        }

        .close-icon:hover {
            color: darkred;
            /* Change the color on hover if desired */
        }


        .section-container {
            background-color: #fff;
            /* Example background color */
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            word-wrap: break-word;
            overflow: auto
        }



        .side-container {
            margin-top: 20px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            min-height: 1400px;
            overflow: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            word-wrap: break-word;
            /* Add this line to allow text wrapping */
        }


        .main-container {
            padding: 20px;
            border-radius: 10px;
            /* Add more styles as needed */
        }

        body {
            background-image: radial-gradient(circle, #b700ff, #3776ff)
        }

        nav li {
            margin: 0 15px;
        }
    </style>
</head>

<body>
    <input type="hidden" id="userId" value="{{ user_id }}">

    <script defer>
        document.addEventListener('DOMContentLoaded', function () {
            // Retrieve the user_id value from the hidden input
            const userId = document.getElementById("userId").value;

            console.log("Fetching username...");
            $.get(`/get-username/${userId}`, function (response) {
                console.log("Username response:", response);
                if (response.success) {
                    const usernamePlaceholder = document.getElementById("username-placeholder");
                    usernamePlaceholder.textContent = "Hello, " + response.username;
                } else {
                    console.error('Error fetching username:', response.error);
                }
            });
        });

    </script>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="https://www.mycareermax.com" style="color: #003c86;">myCareerMax.com</a>
        <button aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"
            data-target="#navbarNav" data-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <!-- Existing dropdown for the username -->
                <li class="nav-item dropdown">
                    <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle"
                        data-toggle="dropdown" href="#" id="navbarDropdown" role="button" style="color: #003c86;">
                        <span id="username-placeholder">Login Here</span>
                    </a>
                    <div aria-labelledby="navbarDropdown" class="dropdown-menu">
                        <a class="dropdown-item" href="/dashboard#my-docs" style="color: #003c86;">My AI Docs</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/login" style="color: #00b018;">Login</a>
                        <a class="dropdown-item" href="/logout" style="color: #0d00ff;">Logout</a>
                        <a class="dropdown-item" href="/delete_account" style="color: #ff0000;">Delete Account</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/dashboard" style="color: #003c86;">myDashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/search" style="color: #003c86;">AI Job Search</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/tools" style="color: #003c86;">Createâœ¨</a>
                </li>
                <!-- Tools Dropdown -->
                <li class="nav-item dropdown">
                    <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle"
                        data-toggle="dropdown" href="#" id="toolsDropdown" role="button" style="color: #003c86;">
                        Tools
                    </a>
                    <div aria-labelledby="toolsDropdown" class="dropdown-menu">
                        <a class="dropdown-item" href="/resume-enhancer" style="color: #003c86;">Resume Scanner</a>
                        <a class="dropdown-item" href="/interview-prep" style="color: #003c86;">Interview Prep</a>
                    </div>
                </li>
                <!-- New link for CareerBot -->
                <li class="nav-item">
                    <a class="nav-link" href="/careerbot" style="color: #003c86;">Max</a>
                </li>
                <!-- End of Dropdown for username -->
            </ul>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <!-- Main Content Container -->
            <div class="col-md-4">
                <div class="main-container">

                    {% if current_user.is_authenticated %}

                    <!-------------------------PERSONAL INFORMATION ----------------------->
                    <div class="section-container">
                        <h2>Personal Information</h2>
                        <div id="personal-info-container">
                            <!-- Personal Information will be loaded here -->
                        </div>
                        <button id="add-new-personal-info">Add New Personal Information</button>
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                loadPersonalInfo();
                                document.getElementById('add-new-personal-info').addEventListener('click', addNewPersonalInfo);
                            });

                            function loadPersonalInfo() {
                                fetch('/personal_information')  // Update to use '/personal_information'
                                    .then(response => response.json())
                                    .then(data => {
                                        const container = document.getElementById('personal-info-container');
                                        container.innerHTML = '';
                                        data.forEach(personalInfo => {
                                            const personalInfoDiv = document.createElement('div');
                                            personalInfoDiv.className = 'personal-info';
                                            personalInfoDiv.id = 'personal-info-' + personalInfo.id;
                                            personalInfoDiv.innerHTML = `
                                                        <p>${personalInfo.full_name}</p>
                                                        <p>Email: ${personalInfo.email}</p>
                                                        <p>Contact Number: ${personalInfo.contact_number}</p>
                                                        <p>City of Residence: ${personalInfo.city_of_residence}</p>
                                                        <p>State of Residence: ${personalInfo.state_of_residence}</p>
                                                        <p>Website: ${personalInfo.website}</p>
                                                        <p>GitHub: ${personalInfo.github}</p>
                                                        <p>LinkedIn: ${personalInfo.linkedin}</p>
                                                        <button onclick="deletePersonalInfo(${personalInfo.id})">Delete Personal Information</button>
                                                    `;
                                            container.appendChild(personalInfoDiv);
                                        });
                                    });
                            }

                            function addNewPersonalInfo() {
                                const container = document.getElementById('personal-info-container');
                                const newPersonalInfoDiv = document.createElement('div');
                                newPersonalInfoDiv.className = 'personal-info';
                                newPersonalInfoDiv.innerHTML = `
                                            <input type="text" id="new-full-name" placeholder="Full Name">
                                            <input type="text" id="new-email" placeholder="Email">
                                            <input type="text" id="new-contact-number" placeholder="Contact Number">
                                            <input type="text" id="new-city-of-residence" placeholder="City of Residence">
                                            <input type="text" id="new-state-of-residence" placeholder="State of Residence">
                                            <input type="text" id="new-website" placeholder="Website">
                                            <input type="text" id="new-github" placeholder="GitHub">
                                            <input type="text" id="new-linkedin" placeholder="LinkedIn">
                                            <button onclick="submitNewPersonalInfo()">Submit New Personal Information</button>
                                        `;
                                container.appendChild(newPersonalInfoDiv);
                            }

                            function submitNewPersonalInfo() {
                                const fullName = document.getElementById('new-full-name').value;
                                const email = document.getElementById('new-email').value;
                                const contactNumber = document.getElementById('new-contact-number').value;
                                const cityOfResidence = document.getElementById('new-city-of-residence').value;
                                const stateOfResidence = document.getElementById('new-state-of-residence').value;
                                const website = document.getElementById('new-website').value;
                                const github = document.getElementById('new-github').value;
                                const linkedin = document.getElementById('new-linkedin').value;

                                const data = {
                                    user_id: '{{ user_id }}',
                                    full_name: fullName,
                                    email: email,
                                    contact_number: contactNumber,
                                    city_of_residence: cityOfResidence,
                                    state_of_residence: stateOfResidence,
                                    website: website,
                                    github: github,
                                    linkedin: linkedin
                                };

                                fetch('/personal_information', {  // Update to use '/personal_information'
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadPersonalInfo();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function deletePersonalInfo(personalInfoId) {
                                fetch(`/personal_information/${personalInfoId}`, { method: 'DELETE' })  // Update to use '/personal_information'
                                    .then(response => response.json())
                                    .then(data => {
                                        loadPersonalInfo();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }
                        </script>
                    </div>
                    <!-------------------------SUMMARY ----------------------->
                    <div class="section-container">
                        <h2>Summary</h2>
                        <div id="summaries">
                            <!-- Existing summaries will be loaded here -->
                        </div>
                        <button id="add-summary-button">Add Summary</button>

                        <form id="add-summary-form" style="display: none;">
                            <textarea id="summary-text" placeholder="Enter your summary"></textarea>
                            <button type="submit">Submit</button>
                        </form>

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                loadSummaries();
                                document.getElementById('add-summary-button').addEventListener('click', toggleAddSummaryForm);

                                // Add event listener for the form submission
                                document.getElementById('add-summary-form').addEventListener('submit', function (event) {
                                    event.preventDefault();
                                    addOrUpdateSummary();
                                });
                            });

                            // Function to load summaries from the backend
                            function loadSummaries() {
                                fetch('/summary?user_id={{ user_id }}')
                                    .then(response => response.json())
                                    .then(data => {
                                        const summariesContainer = document.getElementById('summaries');
                                        summariesContainer.innerHTML = '';

                                        if (data.length === 0) {
                                            // If no summaries exist, show the add-summary form
                                            toggleAddSummaryForm();
                                        }

                                        data.forEach(summary => {
                                            const summaryDiv = document.createElement('div');
                                            summaryDiv.id = `summary-${summary.id}`; // Set a unique ID for each summary
                                            summaryDiv.innerHTML = `
                                                                <p>${summary.summary_text}</p>
                                                                <button onclick="deleteSummary(${summary.id})">Delete</button>
                                                            `;
                                            summariesContainer.appendChild(summaryDiv);
                                        });
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            // Function to toggle the add-summary form visibility
                            function toggleAddSummaryForm() {
                                const addSummaryForm = document.getElementById('add-summary-form');
                                const addSummaryButton = document.getElementById('add-summary-button');

                                if (addSummaryForm.style.display === 'none') {
                                    addSummaryForm.style.display = 'block';
                                    addSummaryButton.style.display = 'none';
                                } else {
                                    addSummaryForm.style.display = 'none';
                                    addSummaryButton.style.display = 'block';
                                }
                            }

                            function addOrUpdateSummary() {
                                const summaryText = document.getElementById('summary-text').value;

                                const data = {
                                    user_id: '{{ user_id }}',
                                    summary_text: summaryText
                                };

                                fetch('/summary', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Handle the response if needed
                                        console.log('Summary added/updated:', data);
                                        loadSummaries(); // Reload the summaries after adding/updating
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            // Function to update a summary
                            function updateSummary(summaryId, updatedSummaryText) {
                                const data = {
                                    summary_text: updatedSummaryText
                                };

                                fetch(`/summary/${summaryId}`, {
                                    method: 'PUT',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadSummaries(); // Reload the summaries after updating
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            // Function to delete a summary
                            function deleteSummary(summaryId) {
                                fetch(`/summary/${summaryId}`, {
                                    method: 'DELETE'
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadSummaries(); // Reload the summaries after deleting
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }
                        </script>
                    </div>


                    <!-------------------------WORK EXPERIENCE ----------------------->
                    <div class="section-container">
                        <h3>Work Experience</h3>
                        <div id="work-experience-container">
                            <!-- Work experiences will be loaded here -->
                        </div>
                        <button id="add-new-experience">Add New Experience</button>

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                loadWorkExperiences();
                                document.getElementById('add-new-experience').addEventListener('click', addNewExperience);
                            });

                            function loadWorkExperiences() {
                                fetch('/work-experience')
                                    .then(response => response.json())
                                    .then(data => {
                                        const container = document.getElementById('work-experience-container');
                                        container.innerHTML = '';
                                        data.forEach(exp => {
                                            const expDiv = document.createElement('div');
                                            expDiv.className = 'work-experience';
                                            expDiv.id = 'work-exp-' + exp.id;
                                            expDiv.innerHTML = `
                            <p>${exp.job_title} at ${exp.company}</p>
                            <p>From: ${exp.start_date} To: ${exp.end_date}</p>
                            <ul id="bullet-points-${exp.id}">
                                ${exp.bullet_points.map(bp => `<li class="bullet-point">${bp.text} <button onclick="deleteBulletPoint(${bp.id}, ${exp.id})">Delete Bullet</button></li>`).join('')}
                            </ul>
                            <button onclick="addBulletPoint(${exp.id})">Add Bullet</button>
                            <button onclick="deleteWorkExperience(${exp.id})">Delete Experience</button>
                        `;
                                            container.appendChild(expDiv);
                                        });
                                    });
                            }

                            function addNewExperience() {
                                const container = document.getElementById('work-experience-container');
                                const newExpDiv = document.createElement('div');
                                newExpDiv.className = 'work-experience';
                                newExpDiv.innerHTML = `
        <input type="text" id="new-job-title" placeholder="Job Title">
        <input type="text" id="new-company" placeholder="Company">
        <input type="date" id="new-start-date">
        <input type="date" id="new-end-date">
        <input type="checkbox" id="current-job" onchange="toggleEndDate()"> Present
        <button onclick="submitNewExperience()">Submit New Experience</button>
    `;
                                container.appendChild(newExpDiv);
                            }

                            function submitNewExperience() {
                                const jobTitle = document.getElementById('new-job-title').value;
                                const company = document.getElementById('new-company').value;
                                const startDate = document.getElementById('new-start-date').value;
                                const isCurrentJob = document.getElementById('current-job').checked;
                                let endDate = document.getElementById('new-end-date').value;

                                // If 'Present' is checked, set endDate to a specific value, e.g., 'Present'
                                if (isCurrentJob) {
                                    endDate = 'Present';
                                }

                                const data = {
                                    user_id: '{{ user_id }}', // Jinja template to insert the user ID
                                    job_title: jobTitle,
                                    company: company,
                                    start_date: startDate,
                                    end_date: endDate
                                };

                                fetch('/work-experience', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadWorkExperiences();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function addBulletPoint(experienceId) {
                                const bulletPointsContainer = document.getElementById(`bullet-points-${experienceId}`);
                                const inputLi = document.createElement('li');
                                inputLi.className = 'bullet-point';
                                inputLi.innerHTML = `
                <input type="text" id="new-bullet-${experienceId}">
                <button onclick="submitBulletPoint(${experienceId})">Submit Bullet</button>
            `;
                                bulletPointsContainer.appendChild(inputLi);
                            }

                            function submitBulletPoint(experienceId) {
                                const bulletText = document.getElementById(`new-bullet-${experienceId}`).value;
                                const data = {
                                    work_experience_id: experienceId,
                                    text: bulletText
                                };

                                fetch('/bullet-point', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadWorkExperiences();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function deleteWorkExperience(experienceId) {
                                fetch(`/work-experience/${experienceId}`, { method: 'DELETE' })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadWorkExperiences();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function deleteBulletPoint(bulletPointId, experienceId) {
                                fetch(`/bullet-point/${bulletPointId}`, { method: 'DELETE' })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadWorkExperiences();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function toggleEndDate() {
                                const endDateInput = document.getElementById('new-end-date');
                                const isCurrentJob = document.getElementById('current-job').checked;

                                if (isCurrentJob) {
                                    endDateInput.disabled = true;
                                    endDateInput.value = ''; // Clear the end date if 'Present' is checked
                                } else {
                                    endDateInput.disabled = false;
                                }
                            }
                        </script>
                    </div>
                    <!-------------------------EDUCATION ----------------------->

                    <div class="section-container">
                        <h3>Education</h3>
                        <div id="education-container">
                            <!-- Education will be loaded here -->
                        </div>
                        <button id="add-new-education">Add New Education</button>

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                loadEducation();
                                document.getElementById('add-new-education').addEventListener('click', addNewEducation);
                            });

                            function loadEducation() {
                                fetch('/education')
                                    .then(response => response.json())
                                    .then(data => {
                                        const container = document.getElementById('education-container');
                                        container.innerHTML = '';
                                        data.forEach(education => {
                                            const educationDiv = document.createElement('div');
                                            educationDiv.className = 'education';
                                            educationDiv.id = 'education-' + education.id;
                                            educationDiv.innerHTML = `
                                <p>${education.degree}</p>
                                <p>Institution: ${education.institution}</p>
                                <p>Graduation Year: ${education.graduation_year}</p>
                                <button onclick="deleteEducation(${education.id})">Delete Education</button>
                            `;
                                            container.appendChild(educationDiv);
                                        });
                                    });
                            }

                            function addNewEducation() {
                                const container = document.getElementById('education-container');
                                const newEducationDiv = document.createElement('div');
                                newEducationDiv.className = 'education';
                                newEducationDiv.innerHTML = `
                    <input type="text" id="new-degree" placeholder="Degree">
                    <input type="text" id="new-institution" placeholder="Institution">
                    <input type="text" id="new-graduation-year" placeholder="Graduation Year">
                    <button onclick="submitNewEducation()">Submit New Education</button>
                `;
                                container.appendChild(newEducationDiv);
                            }

                            function submitNewEducation() {
                                const degree = document.getElementById('new-degree').value;
                                const institution = document.getElementById('new-institution').value;
                                const graduationYear = document.getElementById('new-graduation-year').value;

                                const data = {
                                    user_id: '{{ user_id }}', // Jinja template to insert the user ID
                                    degree: degree,
                                    institution: institution,
                                    graduation_year: graduationYear
                                };

                                fetch('/education', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadEducation();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            function deleteEducation(educationId) {
                                fetch(`/education/${educationId}`, { method: 'DELETE' })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadEducation();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }
                        </script>
                    </div>

                    <!-------------------------PROJECTS ----------------------->
                    <!-- Projects Section for Authenticated Users -->
                    <div class="section-container">
                        <h3>Projects</h3>
                        <div id="project-container">
                            <!-- Projects will be loaded here -->
                        </div>
                        <button id="add-new-project">Add New Project</button>

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                loadProjects();
                                document.getElementById('add-new-project').addEventListener('click', addNewProject);
                            });

                            function loadProjects() {
                                fetch('/projects')
                                    .then(response => response.json())
                                    .then(data => {
                                        const container = document.getElementById('project-container');
                                        container.innerHTML = '';
                                        data.forEach(project => {
                                            const projectDiv = document.createElement('div');
                                            projectDiv.className = 'project';
                                            projectDiv.id = 'project-' + project.id;
                                            projectDiv.innerHTML = `
                            <p>${project.project_name}</p>
                            <p>Description: ${project.description}</p>
                            <p>URL: ${project.url}</p>
                            <ul id="bullet-points-${project.id}">
                                ${project.bullet_points.map(bp => `<li class="bullet-point-project">${bp.text} <button onclick="deleteBulletPoint_project(${bp.id}, ${project.id})">Delete Bullet</button></li>`).join('')}
                            </ul>
                            <button onclick="addBulletPoint_project(${project.id})">Add Bullet</button>
                            <button onclick="deleteProject_project(${project.id})">Delete Project</button>
                        `;
                                            container.appendChild(projectDiv);
                                        });
                                    });
                            }

                            function addNewProject() {
                                const container = document.getElementById('project-container');
                                const newProjectDiv = document.createElement('div');
                                newProjectDiv.className = 'project';
                                newProjectDiv.innerHTML = `
                <input type="text" id="new-project-name" placeholder="Project Name">
                <input type="text" id="new-description" placeholder="Description">
                <input type="text" id="new-url" placeholder="URL">
                <button onclick="submitNewProject()">Submit New Project</button>
            `;
                                container.appendChild(newProjectDiv);
                            }

                            function submitNewProject() {
                                const projectName = document.getElementById('new-project-name').value;
                                const description = document.getElementById('new-description').value;
                                const url = document.getElementById('new-url').value;

                                const data = {
                                    user_id: '{{ user_id }}', // Jinja template to insert the user ID
                                    project_name: projectName,
                                    description: description,
                                    url: url
                                };

                                fetch('/projects', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadProjects();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }

                            // Modify the addBulletPoint_project function
                            function addBulletPoint_project(projectId) {
                                const bulletPointsContainer = document.getElementById(`bullet-points-${projectId}`);
                                const inputLi = document.createElement('li');
                                inputLi.className = 'bullet-point-project'; // Use the correct class name
                                inputLi.innerHTML = `
        <input type="text" id="new-bullet-${projectId}">
        <button onclick="submitBulletPoint_project(${projectId})">Submit Bullet</button>
    `;
                                bulletPointsContainer.appendChild(inputLi);
                            }

                            // Modify the submitBulletPoint_project function
                            function submitBulletPoint_project(projectId) {
                                const bulletText = document.getElementById(`new-bullet-${projectId}`).value;
                                const data = {
                                    project_id: projectId, // Use the correct key
                                    text: bulletText
                                };

                                fetch('/project-bullet-point', { // Use the correct API endpoint for projects
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadProjects();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }


                            function deleteProject_project(projectId) {
                                fetch(`/projects/${projectId}`, { method: 'DELETE' })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadProjects();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }
                            function deleteBulletPoint_project(bulletPointId, projectId) {
                                fetch(`/project-bullet-point/${bulletPointId}`, { method: 'DELETE' })
                                    .then(response => response.json())
                                    .then(data => {
                                        loadProjects();
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }
                        </script>
                    </div>

                    <!-------------------------CERTIFICATIONS ----------------------->

                    <div class="section-container">
                        <h3>Certifications</h3>
                        <div class="certifications-header">
                            <button id="add-new-certification" class="add-certification-button"><span
                                    class="material-symbols-outlined">add</span></button>
                        </div>
                        <div id="certifications-container">
                            <!-- Certifications will be loaded here -->
                        </div>

                        <script>
                            // ... Rest of your JavaScript code ...
                        </script>
                    </div>

                    <div id="certifications-container">
                        <!-- Certifications will be loaded here -->
                    </div>
                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            loadCertifications();
                            document.getElementById('add-new-certification').addEventListener('click', addNewCertification);
                        });

                        function loadCertifications() {
                            fetch('/certifications')  // Assuming you have a '/certifications' endpoint
                                .then(response => response.json())
                                .then(data => {
                                    const container = document.getElementById('certifications-container');
                                    container.innerHTML = '';
                                    data.forEach(certification => {
                                        const certificationDiv = document.createElement('div');
                                        certificationDiv.className = 'certification';
                                        certificationDiv.id = 'certification-' + certification.id;
                                        certificationDiv.innerHTML = `
                            <button onclick="deleteCertification(${certification.id})">Delete Certification</button>
                            <p>${certification.certification_name}</p>
                            <p>Issued by: ${certification.issued_by}</p>
                            <p>Issue Date: ${certification.issue_date}</p>
                            <p>Expiration Date: ${certification.expiration_date}</p>
                        `;
                                        container.appendChild(certificationDiv);
                                    });
                                });
                        }

                        function addNewCertification() {
                            const container = document.getElementById('certifications-container');
                            const newCertificationDiv = document.createElement('div');
                            newCertificationDiv.className = 'certification';
                            newCertificationDiv.innerHTML = `
                <input type="text" id="new-certification-name" placeholder="Certification Name">
                <input type="text" id="new-issued-by" placeholder="Issued by">
                <input type="date" id="new-issue-date" placeholder="Issue Date">
                <input type="date" id="new-expiration-date" placeholder="Expiration Date">
                <button onclick="submitNewCertification()">Submit New Certification</button>
            `;
                            container.appendChild(newCertificationDiv);
                        }

                        function submitNewCertification() {
                            const certificationName = document.getElementById('new-certification-name').value;
                            const issuedBy = document.getElementById('new-issued-by').value;
                            const issueDate = document.getElementById('new-issue-date').value;
                            const expirationDate = document.getElementById('new-expiration-date').value;

                            const data = {
                                user_id: '{{ user_id }}',  // Jinja template to insert the user ID
                                certification_name: certificationName,
                                issued_by: issuedBy,
                                issue_date: issueDate,
                                expiration_date: expirationDate
                            };

                            fetch('/certifications', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(data)
                            })
                                .then(response => response.json())
                                .then(data => {
                                    loadCertifications();
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                });
                        }

                        function deleteCertification(certificationId) {
                            fetch(`/certifications/${certificationId}`, { method: 'DELETE' })
                                .then(response => response.json())
                                .then(data => {
                                    loadCertifications();
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                });
                        }
                    </script>
                </div>

                <!-------------------------SKILLS ----------------------->
                <div class="section-container">
                    <h3>Skills</h3>
                    <div id="skills-container">
                        <!-- Skills will be loaded here -->
                    </div>
                    <button id="add-new-skill">Add New Skill</button>

                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            loadSkills();
                            document.getElementById('add-new-skill').addEventListener('click', addNewSkill);
                        });

                        function loadSkills() {
                            fetch('/skills')
                                .then(response => response.json())
                                .then(data => {
                                    const container = document.getElementById('skills-container');
                                    container.innerHTML = '';

                                    data.forEach(skill => {
                                        const skillDiv = document.createElement('div');
                                        skillDiv.className = 'skill';

                                        // Display the skill, styled icon for close, and attach the deleteSkill function with the skill's ID
                                        skillDiv.innerHTML = `
                    <span>${skill.skill}</span>
                    <span class="material-symbols-outlined close-icon" onclick="deleteSkill(${skill.id})">close</span>
                `;

                                        container.appendChild(skillDiv);
                                    });
                                });
                        }


                        function addNewSkill() {
                            const container = document.getElementById('skills-container');
                            const newSkillDiv = document.createElement('div');
                            newSkillDiv.className = 'skill';
                            newSkillDiv.innerHTML = `
            <textarea id="new-skill" placeholder="Enter skills separated by commas or new lines"></textarea>
            <button onclick="submitNewSkills()">Submit New Skills</button>
        `;
                            container.appendChild(newSkillDiv);
                        }

                        function submitNewSkills() {
                            const skillsInput = document.getElementById('new-skill').value;
                            const skills = skillsInput.split(/,|\n/).map(skill => skill.trim()).filter(skill => skill.length > 0);

                            skills.forEach(skill => {
                                const data = { skill: skill };

                                fetch('/skills', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        console.log('Skill added:', data);
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            });

                            loadSkills(); // Reload skills after adding
                        }

                        function deleteSkill(skillId) {
                            fetch(`/skills/${skillId}`, { method: 'DELETE' })
                                .then(response => response.json())
                                .then(data => {
                                    loadSkills();
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                });
                        }


                    </script>
                </div>
            </div>


            <!------------------------ Side Rectangle Container ---------------------------------------->
            <div class="col-md-8">
                <div class="side-container" style="border: 1px solid #000; height: 600px;">
                    <!-- Including the resume template here -->
                    {% include 'resume.html' %}
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Content for users who are not authenticated -->
    <p>Please log in to access your resume data.</p>
    <a href="/login" class="btn btn-primary">Log In</a>
    {% endif %}


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>