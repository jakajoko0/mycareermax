<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>myCareerMax Job Search</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <style>
        hr {
            border: none;
            height: 1px;
            /* sets the thickness of the line */
            background-color: #dddddd;
            /* sets the color of the line */
            margin-top: 20px;
            /* adds space above the line */
            margin-bottom: 20px;
            /* adds space below the line */
        }

        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
        }

        label,
        input,
        button {
            margin-bottom: 5px;
        }

        #jobs-list {
            width: 100%;
            /* background-color: #7300ff;
    /* Change this to the color you want for the container */
            height: calc(100vh - 150px);
            overflow-y: auto;
            padding: 20px;
            /* This adds padding inside the container around the job boxes */
        }

        .job h2 {
            margin-top: 0;
        }

        .job a {
            display: inline-block;
            padding: 10px 15px;
            background-color: #007BFF;
            color: white;
            text-decoration: none;
            margin-top: 10px;
        }

        .job-title {
            padding: 15px 10px;
            border-bottom: 1px solid #ccc;
            font-weight: bold;
        }

        .job-title:hover {
            background-color: #f5f5f5;
        }

        #search-container {
            position: fixed;
            top: 56px;
            left: 0;
            right: 0;
            background-image: radial-gradient(circle, #b700ff, #3776ff);
            z-index: 1000;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            padding: 10px;
            /* border-bottom: 1px solid #ccc; */
        }

        #search-container input[type="text"] {
            margin: 0 10px 10px 0;
            border-radius: 15px;
            border: 1px solid #ccc;
            padding: 5px;
            text-align: center;
        }

        #search-container input[type="text"]::placeholder {
            text-align: center;
            font-size: 12px;
        }

        #search-button {
            padding: 3px 20px;
            font-size: 14px;
            border-radius: 15px;
            margin-left: 5px;
        }

        #main-content {
            padding-top: 150px;
            width: 100%;
            background-image: radial-gradient(circle, #b700ff, #3776ff);
            /* background-image: linear-gradient(120deg, #b700ff, #3776ff); */
            /* Change this to your desired background color */
            display: flex;
            justify-content: center;
            /* This will center the child elements */
        }

        @media screen and (min-width: 768px) {
            #main-content {
                display: flex;
                flex-direction: row;
                justify-content: center;
                align-items: flex-start;
                padding-top: 150px;
            }

            #jobs-list {
                width: 40%;
                border-right: 1px solid #ccc;
                height: calc(100vh - 150px);
                overflow-y: auto;
            }

            #selected-job-details {
                width: 60%;
                border: 1px solid #ccc;
                margin-bottom: 20px;
                margin-top: 20px;
                margin-left: 20px;
                margin-right: 20px;
                border-radius: 5px;
                background-color: white;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                height: calc(100vh - 150px);
                /* Match height of job listings */
                overflow-y: auto;
                /* Scrollbar appears if content overflows */
                padding: 20px;
            }

            .close-button {
                display: block;
            }
        }

        @media screen and (max-width: 767px) {
            #search-container {
                top: 56px;
            }

            #jobs-list {
                height: calc(100vh - 56px);
                overflow-y: auto;
            }

            #selected-job-details {
                display: none;
                position: fixed;
                top: 56px;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                box-sizing: border-box;
                z-index: 100;
                background-color: rgba(255, 255, 255, 0.9);
                max-height: calc(100vh - 150px);
                overflow-y: auto;
                padding: 20px;
                max-height: calc(100vh - 56px);
            }
        }

        .close-button {
            display: block;
            position: fixed;
            top: 65px;
            right: 15px;
            background: transparent;
            color: red;
            cursor: pointer;
            z-index: 101;
        }


        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1050;
        }



        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .job-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }



        .job-header-bottom {
            flex-basis: 100%;
            margin-top: 10px;
        }

        .logo-container {
            display: flex;
            justify-content: start;
            align-items: center;
        }

        .logo-date-container {
            display: flex;
            justify-content: start;
            align-items: center;
            flex-grow: 1;
        }

        .posted-at {
            padding: 5px;
            border-radius: 5px;
            background-color: #f8f8f8;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .save-icon {
            margin-left: auto;
            margin-right: 10px;
            cursor: pointer;
            padding: 8px;
        }

        .employer-logo {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .job-title {
            width: 100%;
            text-align: left;
            font-size: 1.25em;
            font-weight: bold;
            margin: 0;
            padding: 0;
        }

        .sub-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            font-size: 0.875em;
        }

        .employer-and-city-container {
            display: flex;
            align-items: center;
        }

        .employer-name,
        .job-city {
            margin-right: 0;
        }

        .salary-remote-type-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: start;
            align-items: center;
            margin-top: 10px;
        }

        .salary-range,
        .job-type-remote,
        .employment-type,
        .job-benefit-tag {
            border: 1px solid #ccc;
            border-radius: 15px;
            padding: 10px;
            margin-right: 10px;
            margin-bottom: 10px;
            background-color: #f8f8f8;
            display: inline-block;
        }

        .job.selected {
            border: 5px solid #66ff00;
        }

        .job {
            border: 1px solid #ccc;
            margin-bottom: 20px;
            /* This adds space between job boxes */
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: white;
            /* This sets the job box background color */
            cursor: pointer;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }

        /* Ensure the publisher container has no padding or margin to start with */
        .publisher-name {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            /* Adjust the spacing as needed */
        }
    </style>

</head>

<body>
    <input type="hidden" id="userId" value="{{ user_id }}">

    <script>
        $(document).ready(function () {
            console.log("Fetching username...");
            $.get("/get-username", function (response) {
                console.log("Username response:", response);
                if (response.success) {
                    const usernamePlaceholder = document.getElementById("username-placeholder");
                    usernamePlaceholder.textContent = "Hello, " + response.username;
                } else {
                    console.error('Error fetching username:', response.error);
                }
            });
        });
    </script>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="https://www.mycareermax.com" style="color: #003c86;">myCareerMax.com</a>
        <button aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"
            data-target="#navbarNav" data-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <!-- Existing dropdown for the username -->
                <li class="nav-item dropdown">
                    <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle"
                        data-toggle="dropdown" href="#" id="navbarDropdown" role="button" style="color: #003c86;">
                        <span id="username-placeholder">Login Here</span>
                    </a>
                    <div aria-labelledby="navbarDropdown" class="dropdown-menu">
                        <a class="dropdown-item" href="/dashboard#my-docs" style="color: #003c86;">My AI Docs</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/login" style="color: #00b018;">Login</a>
                        <a class="dropdown-item" href="/logout" style="color: #0d00ff;">Logout</a>
                        <a class="dropdown-item" href="/delete_account" style="color: #ff0000;">Delete Account</a>
                    </div>
                </li>
                <!-- End of Dropdown for username -->
                <li class="nav-item">
                    <a class="nav-link" href="/dashboard" style="color: #003c86;">myDashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/careerclick" style="color: #003c86;">AI Job Search</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/tools" style="color: #003c86;">Createâœ¨</a>
                </li>
                <!-- Tools Dropdown -->
                <li class="nav-item dropdown">
                    <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle"
                        data-toggle="dropdown" href="#" id="toolsDropdown" role="button" style="color: #003c86;">
                        Tools
                    </a>
                    <div aria-labelledby="toolsDropdown" class="dropdown-menu">
                        <a class="dropdown-item" href="/resume-enhancer" style="color: #003c86;">Resume Scanner</a>
                        <a class="dropdown-item" href="/interview-prep" style="color: #003c86;">Interview Prep</a>
                    </div>
                </li>
                <!-- New link for CareerBot -->
                <li class="nav-item">
                    <a class="nav-link" href="/careerbot" style="color: #003c86;">Max</a>
                </li>
            </ul>
        </div>
    </nav>
    <div id="search-container">
        <label for="job-query"></label>
        <input type="text" id="job-query" placeholder="Enter job title or Keyword(s)">
        <label for="job-location"></label>
        <input type="text" id="job-location" placeholder="Enter location">
        <button id="search-button">Search</button>
    </div>

    <div id="main-content">
        <div id="jobs-list">
            <!-- Job listings will be dynamically inserted here -->
        </div>
        <div id="selected-job-details">
            <!-- Job details will be dynamically inserted here including the close button -->
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchButton = document.getElementById('search-button');
            const jobsList = document.getElementById('jobs-list');
            const selectedJobDetails = document.getElementById('selected-job-details');
            let page = 1; // Initialize page counter
            let isFetchingJobs = false;

            function toggleCloseButton(show) {
                const closeButton = document.querySelector('.close-button');
                if (window.innerWidth < 768) {
                    if (show) {
                        if (closeButton) closeButton.style.display = 'block';
                        jobsList.style.display = 'none';
                        document.getElementById('search-container').style.display = 'none';
                    } else {
                        if (closeButton) closeButton.style.display = 'none';
                        jobsList.style.display = 'block';
                        document.getElementById('search-container').style.display = 'flex';
                    }
                }
            }

            function bindCloseButton() {
                const closeButton = document.querySelector('.close-button');
                if (closeButton) {
                    closeButton.addEventListener('click', function () {
                        selectedJobDetails.style.display = 'none';
                        toggleCloseButton(false);
                    });
                }
            }

            function checkScreenSize() {
                if (window.innerWidth < 768) {
                    if (selectedJobDetails.style.display === 'none' || selectedJobDetails.style.display === '') {
                        document.getElementById('search-container').style.display = 'flex';
                        jobsList.style.display = 'block';
                    }
                } else {
                    document.getElementById('search-container').style.display = 'flex';
                    jobsList.style.display = 'block';
                }
                toggleCloseButton(selectedJobDetails.style.display === 'block');
            }

            function fetchMoreJobListings() {
                if (isFetchingJobs) return;
                isFetchingJobs = true;
                page++;

                fetch(`/fetch-job-listings?page=${page}`, {
                    method: 'GET',
                })
                    .then(response => response.json())
                    .then(data => {
                        displayJobListings(data.data || [], true);
                        isFetchingJobs = false;
                    })
                    .catch(error => {
                        console.error('Error fetching job listings:', error);
                        isFetchingJobs = false;
                    });
            }


            function resetAndFetchJobListings() {
                page = 1; // Reset the page counter
                jobsList.innerHTML = ''; // Clear the job list
                fetchJobListings(); // Fetch the job listings
            }

            if (searchButton) {
                searchButton.addEventListener('click', resetAndFetchJobListings);
            }

            function selectFirstJob() {
                const firstJobTitle = document.querySelector('.job-title');
                if (firstJobTitle) {
                    firstJobTitle.click(); // Programmatically click the first job title to display its details
                }
            }

            function fetchJobListings() {
                console.log('Fetching job listings');
                const jobQuery = document.getElementById('job-query').value;
                const jobLocation = document.getElementById('job-location').value;
                // Do not reset page here anymore
                const queryParams = new URLSearchParams({
                    query: jobQuery,
                    location: jobLocation,
                    page: page
                });

                fetch(`/fetch-job-listings?${queryParams.toString()}`, {
                    method: 'GET'
                })
                    .then(response => response.json())
                    .then(data => {
                        displayJobListings(data.data || [], false);
                        isFetchingJobs = false;
                        // Only select the first job if the screen is wider than 767px
                        if (window.innerWidth > 767) {
                            selectFirstJob(); // Select the first job after the listings are displayed
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching job listings:', error);
                        isFetchingJobs = false;
                    });
            }

            // Only setup the initial fetch when the screen is wider than 767px
            if (window.innerWidth > 767) {
                fetchJobListings();
            }


            // Call this function once to setup the infinite scrolling
            function setupInfiniteScroll() {
                const jobsList = document.getElementById('jobs-list');
                jobsList.addEventListener('scroll', () => {
                    // Add a buffer amount to the condition to handle fast scrolling
                    if (jobsList.scrollTop + jobsList.clientHeight >= jobsList.scrollHeight - 200) {
                        fetchMoreJobListings();
                    }
                });
            }

            // Call this function once to setup the infinite scrolling
            setupInfiniteScroll();

            // Function to format job type
            function formatJobType(jobType) {
                const jobTypeMap = {
                    'FULLTIME': 'Full-time',
                    'INTERN': 'Intern',
                    'PERDIEM': 'Per diem',
                    'CONTRACTOR': 'Contractor',
                    'PARTTIME': 'Part-time',
                    'TEMPORARY': 'Temp'
                };
                // Return the mapped value or the original if not found in the map
                return jobTypeMap[jobType] || jobType;
            }

            // Function to map benefit keys to user-friendly text
            function mapBenefitToDisplayText(benefit) {
                const benefitDisplayMap = {
                    'paid_time_off': 'PTO',
                    'health_insurance': 'Health',
                    'retirement_savings': 'Retirement',
                    'dental_coverage': 'Dental',
                    'Part-time Benefit Eligible': 'PT Benefit Eligible',
                };

                // Return the display text if found, or default to the benefit as-is
                return benefitDisplayMap[benefit] || benefit.replace(/_/g, ' ');
            }

            // Function to format the date and time
            function formatDateTime(dateTimeString) {
                // Create a Date object from the dateTimeString
                const date = new Date(dateTimeString);
                // Format the date and time in a readable format
                return date.toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' });
            }

            // Function to remove 'selected' class from all job cards
            function clearSelectedJobCards() {
                document.querySelectorAll('.job.selected').forEach(function (jobCard) {
                    jobCard.classList.remove('selected');
                });
            }

            function displayJobListings(jobs, append = false) {
                let oldScrollPosition = jobsList.scrollTop;
                if (!append) {
                    jobsList.innerHTML = '';
                    selectedJobDetails.innerHTML = '';
                }


                jobs.forEach(job => {                    // Create a new div for the job card
                    const jobCard = document.createElement('div');
                    jobCard.className = 'job';

                    // Create a container div for the logo and the date
                    const jobHeaderTop = document.createElement('div');
                    jobHeaderTop.className = 'job-header-top';

                    // Create logo container and logo image
                    const logoContainer = document.createElement('div');
                    logoContainer.className = 'logo-container';
                    const logoImg = document.createElement('img');
                    logoImg.src = job.employer_logo || '/static/images/default_logo.png';
                    logoImg.alt = job.employer_name + ' logo';
                    logoImg.className = 'employer-logo';
                    logoImg.onerror = function () {
                        this.src = '/static/images/default_logo.png';
                    };
                    logoContainer.appendChild(logoImg);

                    // Date text
                    const postedAtDiv = document.createElement('div');
                    postedAtDiv.className = 'posted-at';
                    postedAtDiv.innerText = formatDateTime(job.job_posted_at_datetime_utc);

                    jobCard.setAttribute('data-job-id', job.job_id);

                    // Save icon
                    const saveIcon = document.createElement('span');
                    saveIcon.className = 'material-symbols-outlined save-icon';
                    saveIcon.textContent = 'format_list_bulleted_add';

                    // This function is called when the save icon is clicked.
                    saveIcon.onclick = function (event) {
                        // Prevent the default action to avoid any unwanted behavior like page navigation
                        event.preventDefault();

                        // Get the closest job card to the clicked element
                        const jobCard = event.target.closest('.job');

                        // Extract the job ID from the data attribute
                        const jobId = jobCard.getAttribute('data-job-id');

                        // Check if the job is already saved or not
                        if (saveIcon.textContent.includes('format_list_bulleted_add')) {
                            // If not saved, save the job
                            const jobData = {
                                job_id: job.job_id,
                                job_title: job.job_title,
                                job_description: job.job_description,
                                job_link: job.job_apply_link,
                                job_loc: job.job_city,
                                company_name: job.employer_name,
                                link: window.location.href,
                                employer_logo: job.employer_logo
                            };

                            fetch('/save-job', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(jobData)
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        console.log('Job saved successfully');
                                        // Change the icon to 'heart_minus' and add a new onclick event to remove the job
                                        saveIcon.innerHTML = '<span class="material-symbols-outlined">add_task</span>';
                                        saveIcon.onclick = removeSavedJob; // Assign the remove function
                                        saveIcon.classList.add('saved');
                                    } else {
                                        console.error('Failed to save job:', data.error);
                                    }
                                })
                                .catch(error => {
                                    console.error('Error saving job:', error);
                                });
                        } else {
                            // If already saved, remove the job
                            removeSavedJob(jobId);
                        }
                    };

                    function removeSavedJob(jobId) {
                        // Ensure that jobId is a string or number here
                        fetch('/remove-saved-job', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ job_id: jobId }) // Correct payload
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    console.log('Job removed successfully');
                                    // Handle UI updates here, such as changing the save icon back to 'heart_plus'
                                    // and updating the onclick event handler to save the job again.
                                } else {
                                    console.error('Failed to remove job:', data.error);
                                }
                            })
                            .catch(error => {
                                console.error('Error removing job:', error);
                            });
                    }


                    // Append the logo container and date to the jobHeaderTop
                    jobHeaderTop.appendChild(logoContainer);
                    jobHeaderTop.appendChild(postedAtDiv);

                    // Append the save icon to the jobHeaderTop
                    jobHeaderTop.appendChild(saveIcon);


                    // Create a new div for the job title, which will be below the logo and date
                    const jobHeaderBottom = document.createElement('div');
                    jobHeaderBottom.className = 'job-header-bottom';

                    // Job title
                    const jobTitle = document.createElement('div');
                    jobTitle.className = 'job-title';
                    jobTitle.innerText = job.job_title || 'No title provided';
                    jobHeaderBottom.appendChild(jobTitle);

                    // Append the job header top and bottom to the job card
                    jobCard.appendChild(jobHeaderTop);
                    jobCard.appendChild(jobHeaderBottom);

                    // Create a sub-container for employer name and job city
                    const subHeader = document.createElement('div');
                    subHeader.className = 'sub-header';

                    // Create a div for the employer name and add it to the sub-header
                    const employerNameDiv = document.createElement('div');
                    employerNameDiv.className = 'employer-name';
                    employerNameDiv.innerText = job.employer_name;
                    subHeader.appendChild(employerNameDiv);

                    // Add the job city if it is specified and not "Not specified"
                    if (job.job_city && job.job_city !== "Not specified") {
                        employerNameDiv.innerText += ', ' + job.job_city; // Append city to employer name
                    }

                    // Create a div for the employment type but do not append yet
                    const employmentTypeDiv = document.createElement('div');
                    employmentTypeDiv.className = 'employment-type';
                    employmentTypeDiv.innerText = formatJobType(job.job_employment_type) || 'Not specified';

                    // Append the sub-header to the job card
                    jobCard.appendChild(subHeader);

                    // Publisher name
                    const publisherDiv = document.createElement('div');
                    publisherDiv.className = 'publisher-name';
                    publisherDiv.innerText = `via ${job.job_publisher || 'Not specified'}`;
                    jobCard.appendChild(publisherDiv);

                    // Create a container for the salary, remote information, employment type, and benefits
                    const salaryRemoteTypeContainer = document.createElement('div');
                    salaryRemoteTypeContainer.className = 'salary-remote-type-info';

                    // Function to format salary
                    function formatSalary(salary) {
                        if (salary >= 1000) {
                            return `$${(salary / 1000).toFixed(0)}K`;
                        } else {
                            return `$${salary}`;
                        }
                    }

                    // Add salary information if available
                    if (job.job_max_salary && job.job_min_salary) {
                        const salaryRange = document.createElement('div');
                        salaryRange.className = 'salary-range';
                        salaryRange.innerText = `${formatSalary(job.job_min_salary)} - ${formatSalary(job.job_max_salary)}`;
                        salaryRemoteTypeContainer.appendChild(salaryRange);
                    }

                    // Add remote information
                    const jobTypeRemote = document.createElement('div');
                    jobTypeRemote.className = 'job-type-remote';
                    jobTypeRemote.innerText = job.job_is_remote ? 'Work From Home' : 'In-Person';
                    salaryRemoteTypeContainer.appendChild(jobTypeRemote);

                    // Append the employment type to the right
                    salaryRemoteTypeContainer.appendChild(employmentTypeDiv);

                    // Add job benefits if available
                    if (job.job_benefits && job.job_benefits.length > 0) {
                        job.job_benefits.forEach(benefit => {
                            const benefitText = mapBenefitToDisplayText(benefit); // Get the display text for each benefit
                            const benefitTag = createBenefitTag(benefitText); // Create the benefit tag
                            salaryRemoteTypeContainer.appendChild(benefitTag); // Append the benefit tag to the container
                        });
                    }

                    // Function to create a benefit tag
                    function createBenefitTag(benefitText) {
                        const benefitDiv = document.createElement('div');
                        benefitDiv.className = 'job-benefit-tag';
                        benefitDiv.innerText = benefitText; // Set the innerText to the benefitText passed in
                        benefitDiv.style.border = '1px solid #ccc';
                        benefitDiv.style.borderRadius = '15px';
                        benefitDiv.style.padding = '10px';
                        benefitDiv.style.marginRight = '10px';
                        benefitDiv.style.backgroundColor = '#f8f8f8';
                        benefitDiv.style.display = 'inline-block';
                        return benefitDiv;
                    }

                    // Append the salary, remote, and type container to the job card
                    jobCard.appendChild(salaryRemoteTypeContainer);

                    // Event listener for when a job title is clicked
                    jobTitle.addEventListener('click', function () {
                        clearSelectedJobCards();
                        jobCard.classList.add('selected'); // Highlight the selected job card

                        // Populate the selectedJobDetails with detailed information
                        selectedJobDetails.innerHTML = `
        <span class="material-symbols-outlined close-button">close</span>
        <div class="job-details">
            <h2><strong>${job.job_title}</strong></h2>
            <div class="employer-and-location-container">
                <p style="margin-bottom: 1px; color: gray;">${job.employer_name}</p> 
                <p style="margin-top: 1px; color: gray;">${job.job_city || 'Not specified'}</p>
            </div>
            <hr>
            <div class="job-employment-salary-benefits">
                <p><strong>Employment Type:</strong> ${formatJobType(job.job_employment_type) || 'Not specified'}</p>
                <p><strong>Work Environment:</strong> ${job.job_is_remote ? 'Remote' : 'In-Person'}</p>
                <p><strong>Salary:</strong> ${job.job_salary ? `$${job.job_salary}` : 'Not specified'}</p>
                <p><strong>Benefits:</strong> ${job.job_benefits && job.job_benefits.length > 0
                                ? job.job_benefits.map(benefit => mapBenefitToDisplayText(benefit)).join(', ')
                                : 'Not specified'
                            }</p>
            </div>
            <hr>
            <p>${job.job_apply_link ? `<a href="${job.job_apply_link}" target="_blank" style="display: inline-block; padding: 5px 15px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px;">Apply Here</a>` : 'Not provided'}</p>
            <hr>
            <div class="highlights-title-subtitle-container">
                <p style="margin-bottom: 1px; color: black; font-size: 18px;"><strong>Job highlights</strong></p>
                <p style="margin-top: 1px; color: gray; font-size: 14px;">Identified from the original job post</p>
            </div>
            ${Object.entries(job.job_highlights).map(([key, value]) => `
                <strong>${key}:</strong>
                <ul>${value.map(item => `<li>${item}</li>`).join('')}</ul>
            `).join('')}
            <hr>
            <p><strong>Job Description</strong></p>
            <p>${job.job_description}</p>
        </div>
    `;
                        selectedJobDetails.style.display = 'block';
                        toggleCloseButton(true);
                        bindCloseButton();
                    });


                    // Append the job card to the jobsList container
                    jobsList.appendChild(jobCard);
                });

                if (append) {
                    // Use setTimeout to delay the scroll restoration
                    setTimeout(() => {
                        jobsList.scrollTop = oldScrollPosition;
                    }, 0); // A timeout of 0 ms still pushes the execution to the end of the call stack
                }
            }



            setupInfiniteScroll();
            checkScreenSize();
            window.addEventListener('resize', checkScreenSize);

        });
    </script>


</body>

</html>