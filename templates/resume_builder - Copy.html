<!DOCTYPE html>
<html>

<head>
    <title>Resume Builder</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Clicker+Script&display=swap" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .delete-project-btn {
            background-color: red;
            /* Red background */
            color: white;
            /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Box shadow */
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .delete-project-btn:hover {
            background-color: #a30000;
            /* Darker red on hover */
        }

        .certifications-header {
            display: flex;
            justify-content: flex-end;
            /* Align button to the top right */
            margin-bottom: 10px;
            /* Add some space between the button and certifications */
        }

        .add-certification-button {
            position: absolute;
            top: 10px;
            /* Adjust as needed */
            right: 10px;
            /* Adjust as needed */
            border: none;
            background-color: transparent;
            /* Or any color you prefer */
            cursor: pointer;
        }

        /* Update the selector to target the span inside the button with class 'add-certification-button' */
        .add-certification-button .material-symbols-outlined {
            font-size: 48px;
            /* Adjust size as needed */
            color: #006400;
            /* Or any color you prefer */
        }



        /* Add this CSS in your stylesheet or <style> tag */
        .close-icon {
            font-size: 24px;
            /* Adjust the size as needed */
            color: red;
            cursor: pointer;
        }

        .close-icon:hover {
            color: darkred;
            /* Change the color on hover if desired */
        }


        .section-container {
            background-color: #fff;
            /* Example background color */
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            word-wrap: break-word;
            overflow: auto
        }

        .section-container {
            position: relative;
            /* Required for absolute positioning of the button */
        }

        #add-new-project {
            position: absolute;
            top: 10px;
            /* Adjust as needed */
            right: 10px;
            /* Adjust as needed */
            border: none;
            background-color: transparent;
            /* Or any color you prefer */
            cursor: pointer;
        }

        #add-new-project .material-symbols-outlined {
            font-size: 48px;
            /* Adjust size as needed */
            color: #006400;
            /* Or any color you prefer */
        }


        #add-new-education {
            position: absolute;
            top: 10px;
            /* Adjust as needed */
            right: 10px;
            /* Adjust as needed */
            border: none;
            background-color: transparent;
            /* Or any color you prefer */
            cursor: pointer;
        }

        #add-new-education .material-symbols-outlined {
            font-size: 48px;
            /* Adjust size as needed */
            color: #006400;
            /* Or any color you prefer */
        }


        #add-new-personal-info {
            position: absolute;
            top: 10px;
            /* Adjust as needed */
            right: 10px;
            /* Adjust as needed */
            border: none;
            background-color: transparent;
            /* Or any color you prefer */
            cursor: pointer;
        }

        #add-new-personal-info .material-symbols-outlined {
            font-size: 48px;
            /* Adjust size as needed */
            color: #006400;
            /* Or any color you prefer */
        }

        #add-new-experience {
            position: absolute;
            top: 10px;
            /* Adjust as needed */
            right: 10px;
            /* Adjust as needed */
            border: none;
            background-color: transparent;
            /* Or any color you prefer */
            cursor: pointer;
        }

        #add-new-experience .material-symbols-outlined {
            font-size: 48px;
            color: #006400;
        }


        .side-container {
            margin-top: 20px;
            background-image: url('/static/images/resume_preview.svg');
            padding: 20px;
            border-radius: 10px;
            min-height: 825px;
            overflow: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            word-wrap: break-word;
            /* Add this line to allow text wrapping */
        }


        .main-container {
            padding: 20px;
            min-height: 900px;
            border-radius: 10px;
            background-image: url('/static/images/jobs_list_bg.svg');
            /* Example fixed height */
            overflow-y: auto;
            margin-top: 20px;
            /* Show scrollbar only when needed */
            /* Additional styling (e.g., padding, margins) can be added as per your design needs */
        }

        body {
            background-image: radial-gradient(circle, #b700ff, #3776ff)
        }

        body {
            font-size: 14px;
            /* Base font size */
        }

        nav li {
            margin: 0 15px;
        }

        .section-toggle {
            display: none;
        }

        .section-label {
            /* Style your label/header here */
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
        }

        .section-content {
            display: none;
            /* additional styling for the content */
        }

        .section-toggle:checked+.section-label+.section-content {
            display: block;
        }

        .submit-btn {
            background-color: rgb(0, 21, 255);
            color: white;
            /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Box shadow */
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background-color: #000264;
            /* Darker green on hover */
        }

        .submit-new-skills-btn {
            background-color: rgb(0, 21, 255);
            /* Green background */
            color: white;
            /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Box shadow */
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .delete-btn {
            background-color: red;
            /* Red background */
            color: white;
            /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Box shadow */
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background-color: #a30000;
            /* Darker red on hover */
        }

        .add-summary-btn {
            background-color: green;
            /* Green background */
            color: white;
            /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Box shadow */
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-summary-btn:hover {
            background-color: #006400;
            /* Darker green on hover */
        }

        .add-new-skill-btn {
            background-color: green;
            /* Green background */
            color: white;
            /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Box shadow */
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-new-skill-btn:hover {
            background-color: #006400;
            /* Darker green on hover */
        }

        .add-key-skills-btn {
            background: linear-gradient(to right, #7b00ff, #005eff);
            /* Gradient background */
            color: white;
            /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Box shadow */
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-key-skills-btn:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, #2575fc, #6a11cb);
        }

        .add-bullet-exp {
            background-color: green;
            /* Green background */
            color: white;
            /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Box shadow */
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-bullet-exp:hover {
            background-color: #006400;
            /* Darker green on hover */
        }

        .resume-header {
            display: flex;
            align-items: center;
            justify-content: center;
            /* Center everything */
        }

        .mycareermax-resume-title {
            font-size: .75em;
            margin-bottom: 3px;
            font-family: 'Poppins', sans-serif;
            margin-right: 10px;
            /* Add some space between text and icon */
            color: white;
            display: inline-block;
            /* Ensure inline or inline-block */
        }

        .pdf-icon {
            color: white;
            cursor: pointer;
            font-size: 24px;
            display: inline-block;
            /* Ensure inline or inline-block */
        }


        .preview-notice {
            font-size: 14px;
            /* Adjust as needed for readability */
            border-radius: 5px;
            line-height: 1.6;
            /* Spacing between lines for better readability */
            color: #ffffff;
            /* Color of the text, choose a readable color */
            margin-bottom: 20px;
            /* Space before the resume preview starts */
            margin-top: 20px;
            font-family: 'Quicksand', sans-serif;
            padding: 0 15px;
            /* Padding on the sides */
            box-shadow: 3px 4px 8px rgba(0, 0, 0, 0.9);
            /* Box shadow */
            background-color: #6f6f6f;
            /* Light gray background */
            padding: 15px;
            /* Add some padding around the text */
            margin-bottom: 15px;
            /* Add some margin at the bottom */
        }

        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 48;
            /*   color: rgb(81, 0, 255)
               */
        }

        .view-resume-icon {
            color: white;
            cursor: pointer;
            font-size: 80px;
            display: block;
            /* Make the icon a block element to center it */
            margin: 0 auto;
            /* Center the icon horizontally */
            text-align: center;
            /* Center the text inside the icon */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            /* Add shadow to the text */
        }

        /* The Modal (background) */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            /* Semi-transparent background outside the modal */
            border-radius: 10px;
        }

        /* Base Modal Content Styling */
        .modal-content {
            background: linear-gradient(to right, rgb(92, 159, 236), #ffffff);
            color: rgb(0, 0, 0);
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #00ff04;
            width: 80%;
            /* Default width */
            max-width: 600px;
            /* Maximum width */
            border-radius: 20px;
            font-size: 1rem;
            /* Responsive font size */
        }

        /* Specific styling for smaller screens */
        @media screen and (max-width: 600px) {
            .modal-content {
                width: 90%;
                /* Increase width on smaller screens */
                font-size: 0.9rem;
                /* Slightly smaller font size for very narrow screens */
            }
        }

        /* Responsive paragraph text inside modal */
        .modal-content p {
            font-size: 1em;
            /* Responsive font size */
        }


        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Buttons */
        #use-rephrased-summary,
        #discard-rephrased-summary {
            color: white;
            border: none;
            padding: 10px 15px;
            /* Adjust padding for size */
            border-radius: 5px;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            width: auto;
            /* Adjust width to content */
            display: inline-block;
            /* Align buttons next to each other */
        }

        #use-rephrased-summary {
            background-color: #00a803;
        }

        #discard-rephrased-summary {
            background-color: rgb(255, 38, 0);
        }

        #use-rephrased-summary:hover {
            box-shadow: 0px 4px 10px rgba(0, 128, 0, 0.3);
        }

        #discard-rephrased-summary:hover {
            box-shadow: 0px 4px 10px rgba(128, 0, 0, 0.3);
        }

        .sparkles-bullets-btn {
            background: linear-gradient(to right, #7b00ff, #005eff);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-bottom: 8px;
        }

        .sparkles-bullets-btn:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, #2575fc, #6a11cb);
        }


        /* Change Button Styling */
        #change-btn {
            background: linear-gradient(to right, #7b00ff, #005eff);
            /* Gradient background */
            color: white;
            /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            /* Rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Box shadow */
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        #change-btn:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            /* Slightly larger shadow on hover */
            background: linear-gradient(to right, #2575fc, #6a11cb);
            /* Slightly different gradient on hover */
        }

        /* Base styling for the textarea */
        .responsive-textarea {
            width: 90%;
            /* 90% of its container */
            height: 9em;
            /* Adjust height as needed */
            max-width: 100%;
            /* Ensures it doesn't overflow its container */
            margin: auto;
            /* Center it within the container */
            display: block;
            /* To enable margin auto to work */
            resize: vertical;
            /* Allow only vertical resizing */
        }

        /* Specific styling for smaller screens */
        @media screen and (max-width: 600px) {
            .responsive-textarea {
                width: 95%;
                /* Slightly wider on smaller screens */
                height: 7em;
                /* Adjust height for narrow screens */
            }
        }

        .sparkles-icon {
            cursor: pointer;
        }

        .skill-textarea {
            width: 90%;
            max-width: 100%;
            /* Ensures it doesn't overflow its container */
            box-sizing: border-box;
            /* Includes padding and border in the width */
            /* Additional styling as needed */
        }


        .modal-title {
            text-align: center;
            /* Centers the title text in the modal */
        }

        .close-modal-btn {
            display: block;
            margin: 10px auto;
            /* Centers the button in the modal */
            padding: 5px 10px;
            /* Adds some padding to the button */
            cursor: pointer;
            /* Changes the cursor to pointer on hover */
            margin-top: 10px;
            color: #ff3c3c;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-icon {
            color: red;
            /* Change the color of the close icon to red */
        }

        .material-symbols-outlined.add-icon {
            cursor: pointer;
            color: #00a803
                /* Sets the color of the icon to green */
        }

        .material-symbols-outlined.sparkles-icon {
            font-size: 20px;
        }

        .material-symbols-outlined.close-icon {
            position: relative;
            top: 5px;
            /* Adjust the value as needed */
        }

        /* Enhanced Bullet Modal buttons */
        .enhanced-modal-button {
            margin: 10px 5px;
            /* Adjust the margin values as needed */
        }

        /* Apply this class to both buttons in the modal */

        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            /* 5% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            /* Could be more or less, depending on screen size */
        }

        .button.close-modal {
            color: rgb(140, 140, 140);

        }

        .close-modal:hover,
        .close-modal:focus {
            color: rgb(121, 121, 121);
            text-decoration: none;
            cursor: pointer;
        }

        .skills-list {
            margin-top: 20px;
        }

        .skill-item {
            margin-bottom: 10px;
        }

        .add-skill-icon {
            color: #00a803;
            position: relative;
            top: 6px;
            /* Adjust this value as needed */
            cursor: pointer;
            /* To show a pointer cursor on hover */
        }
    </style>
</head>

<body>
    <input type="hidden" id="userId" value="{{ user_id }}">

    <script defer>
        document.addEventListener('DOMContentLoaded', function () {
            // Retrieve the user_id value from the hidden input
            const userId = document.getElementById("userId").value;

            console.log("Fetching username...");
            $.get(`/get-username/${userId}`, function (response) {
                console.log("Username response:", response);
                if (response.success) {
                    const usernamePlaceholder = document.getElementById("username-placeholder");
                    usernamePlaceholder.textContent = "Hello, " + response.username;
                } else {
                    console.error('Error fetching username:', response.error);
                }
            });
        });

    </script>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="https://www.mycareermax.com" style="color: #003c86;">myCareerMax.com</a>
        <button aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"
            data-target="#navbarNav" data-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <!-- Existing dropdown for the username -->
                <li class="nav-item dropdown">
                    <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle"
                        data-toggle="dropdown" href="#" id="navbarDropdown" role="button" style="color: #003c86;">
                        <span id="username-placeholder">Login Here</span>
                    </a>
                    <div aria-labelledby="navbarDropdown" class="dropdown-menu">
                        <a class="dropdown-item" href="/dashboard#my-docs" style="color: #003c86;">My AI Docs</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/login" style="color: #00b018;">Login</a>
                        <a class="dropdown-item" href="/logout" style="color: #0d00ff;">Logout</a>
                        <a class="dropdown-item" href="/delete_account" style="color: #ff0000;">Delete Account</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/dashboard" style="color: #003c86;">myDashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/search" style="color: #003c86;">AI Job Search</a>
                </li>
                <!-- Tools Dropdown -->
                <li class="nav-item dropdown">
                    <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle"
                        data-toggle="dropdown" href="#" id="toolsDropdown" role="button" style="color: #003c86;">
                        Tools
                    </a>
                    <div aria-labelledby="toolsDropdown" class="dropdown-menu">
                        <a class="dropdown-item" href="/resume-report" style="color: #003c86;">Resume Report</a>
                        <a class="dropdown-item" href="/interview-prep" style="color: #003c86;">Interview Prep</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/create" style="color: #003c86;">Create✨</a>
                </li>
                <!-- New link for CareerBot -->
                <li class="nav-item">
                    <a class="nav-link" href="/careerbot" style="color: #003c86;">Max</a>
                </li>
                <!-- End of Dropdown for username -->
            </ul>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <!-- Main Content Container -->
            <div class="col-md-4">
                <div class="main-container" style="height: 500px; overflow-y: auto;">
                    <div>
                        {% if current_user.is_authenticated %}
                        <div style="text-align: center;">
                            <div class="resume-header">
                                <div class="mycareermax-resume-title">
                                    <h2 style="margin-bottom: 1px;">Build Your ATS Optimized</h2>
                                    <!-- Reduced margin-bottom -->
                                </div>
                            </div>
                        </div>

                        <!-- Add the centered and scaled image -->
                        <div style="text-align: center; margin-top: 10px;"> <!-- Increased margin-top -->
                            <img src="https://drive.google.com/uc?export=download&id=1GOvninF-QfNN8ACfnHDnR5kJWZ4QYb--"
                                alt="MyCareerMax Resume Title Image" style="width: 105%; margin-bottom: 20px;">
                            <!-- Increased margin-bottom -->
                        </div>


                        <!-------------------------PERSONAL INFORMATION ----------------------->
                        <div class="section-container">
                            <input type="checkbox" id="toggle-personal-info" class="section-toggle">
                            <label for="toggle-personal-info" class="section-label"><span
                                    class="material-symbols-outlined">
                                    unfold_more
                                </span>Personal Information</label>
                            <div class="section-content">
                                <div id="personal-info-container">
                                    <!-- Personal Information will be loaded here -->
                                </div>
                                <button id="add-new-personal-info"><span class="material-symbols-outlined">
                                        add
                                    </span></button>
                            </div>

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    loadPersonalInfo();
                                    document.getElementById('add-new-personal-info').addEventListener('click', addNewPersonalInfo);
                                });

                                function loadPersonalInfo() {
                                    fetch('/personal_information')  // Update to use '/personal_information'
                                        .then(response => response.json())
                                        .then(data => {
                                            const container = document.getElementById('personal-info-container');
                                            container.innerHTML = '';
                                            data.forEach(personalInfo => {
                                                const personalInfoDiv = document.createElement('div');
                                                personalInfoDiv.className = 'personal-info';
                                                personalInfoDiv.id = 'personal-info-' + personalInfo.id;
                                                personalInfoDiv.innerHTML = `
                                                    <p>${personalInfo.full_name}</p>
                                                    <p>Email: ${personalInfo.email}</p>
                                                    <p>Contact Number: ${personalInfo.contact_number}</p>
                                                    <p>City of Residence: ${personalInfo.city_of_residence}</p>
                                                    <p>State of Residence: ${personalInfo.state_of_residence}</p>
                                                    <p>Website: ${personalInfo.website}</p>
                                                    <p>GitHub: ${personalInfo.github}</p>
                                                    <p>LinkedIn: ${personalInfo.linkedin}</p>
    <button class="delete-btn" onclick="deletePersonalInfo(${personalInfo.id})">
        Delete Personal Information
    </button>                                                `;
                                                container.appendChild(personalInfoDiv);
                                            });
                                        });
                                }

                                function addNewPersonalInfo() {
                                    const container = document.getElementById('personal-info-container');
                                    const newPersonalInfoDiv = document.createElement('div');
                                    newPersonalInfoDiv.className = 'personal-info';
                                    newPersonalInfoDiv.innerHTML = `
                                            <input type="text" id="new-full-name" placeholder="Full Name">
                                            <input type="text" id="new-email" placeholder="Email">
                                            <input type="text" id="new-contact-number" placeholder="Contact Number">
                                            <input type="text" id="new-city-of-residence" placeholder="City of Residence">
                                            <input type="text" id="new-state-of-residence" placeholder="State of Residence">
                                            <input type="text" id="new-website" placeholder="Website">
                                            <input type="text" id="new-github" placeholder="GitHub">
                                            <input type="text" id="new-linkedin" placeholder="LinkedIn">
<button class="submit-btn" onclick="submitNewPersonalInfo()">
    Submit New Personal Information
</button>
                                        `;
                                    container.appendChild(newPersonalInfoDiv);
                                }

                                function submitNewPersonalInfo() {
                                    const fullName = document.getElementById('new-full-name').value;
                                    const email = document.getElementById('new-email').value;
                                    const contactNumber = document.getElementById('new-contact-number').value;
                                    const cityOfResidence = document.getElementById('new-city-of-residence').value;
                                    const stateOfResidence = document.getElementById('new-state-of-residence').value;
                                    const website = document.getElementById('new-website').value;
                                    const github = document.getElementById('new-github').value;
                                    const linkedin = document.getElementById('new-linkedin').value;

                                    const data = {
                                        user_id: '{{ user_id }}', // Ensure this is correctly populated
                                        full_name: fullName,
                                        email: email,
                                        contact_number: contactNumber,
                                        city_of_residence: cityOfResidence,
                                        state_of_residence: stateOfResidence,
                                        website: website,
                                        github: github,
                                        linkedin: linkedin
                                    };

                                    fetch('/personal_information', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(data)
                                    })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            // Assuming loadPersonalInfo updates the personal info section
                                            loadPersonalInfo();
                                            // Update the entire side-container with the latest resume data
                                            updateSideContainer();
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }


                                function deletePersonalInfo(personalInfoId) {
                                    fetch(`/personal_information/${personalInfoId}`, { method: 'DELETE' })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json(); // Ensure your server is returning JSON here
                                        })
                                        .then(data => {
                                            loadPersonalInfo();
                                            updateSideContainer();
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }

                                function updateSideContainer() {
                                    fetch('/update-resume') // Corrected endpoint
                                        .then(response => response.text())
                                        .then(html => {
                                            document.querySelector('.side-container').innerHTML = html;
                                        })
                                        .catch(error => {
                                            console.error('Error updating side container:', error);
                                        });
                                }


                            </script>
                        </div>

                        <!-------------------------SUMMARY ----------------------->
                        <div class="section-container">
                            <input type="checkbox" id="toggle-summary" class="section-toggle">
                            <label for="toggle-summary" class="section-label">
                                <span class="material-symbols-outlined">unfold_more</span>Summary
                            </label>
                            <div class="section-content">
                                <div id="summaries">
                                    <!-- Existing summaries will be loaded here -->
                                </div>
                                <button class="add-summary-btn" id="add-summary-button">Add Summary</button>

                                <form id="add-summary-form" style="display: none;">
                                    <textarea id="summary-text" class="responsive-textarea"
                                        placeholder="Enter your summary"></textarea>
                                    <button type="submit" class="submit-btn">Submit</button>
                                    <button type="button" id="change-btn" class="change-btn" style="display: none;">✨
                                        Optimize</button>
                                </form>
                                <!-- The Modal -->
                                <div id="rephraseModal" class="modal">

                                    <!-- Modal content -->
                                    <div class="modal-content">
                                        <span class="close">&times;</span>
                                        <p id="rephrased-summary">Rephrased summary will appear here.</p>
                                        <button id="use-rephrased-summary">Add to Resume</button>
                                        <button id="discard-rephrased-summary">Keep Original</button>
                                    </div>

                                </div>


                            </div>

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    loadSummaries();
                                    document.getElementById('add-summary-button').addEventListener('click', toggleAddSummaryForm);

                                    // Add event listener for the form submission
                                    document.getElementById('add-summary-form').addEventListener('submit', function (event) {
                                        event.preventDefault();
                                        addOrUpdateSummary();
                                    });

                                    // Initialize Bootstrap Tooltips
                                    $('[data-toggle="tooltip"]').tooltip();
                                });


                                // Event listener for the Change button
                                const changeBtn = document.getElementById('change-btn');
                                if (changeBtn) {
                                    changeBtn.addEventListener('click', function () {
                                        const summaryText = document.getElementById('summary-text').value;

                                        // Make sure this URL is the one where your backend handles the OpenAI API call
                                        fetch('/rephrase-summary', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({ summary: summaryText })
                                        })
                                            .then(response => {
                                                if (response.status === 403) {
                                                    // Display an alert if the user needs to upgrade to the Premium Plan
                                                    alert("Upgrade required for Premium Plan to use this feature.");
                                                    return;  // Stop further processing
                                                }
                                                if (!response.ok) {
                                                    throw new Error('Network response was not ok');
                                                }
                                                return response.json();
                                            })
                                            .then(data => {
                                                console.log('OpenAI response:', data);

                                                // Assuming data contains the rephrased summary
                                                // Show the modal with the rephrased summary
                                                const modal = document.getElementById("rephraseModal");
                                                modal.style.display = "block";
                                                document.getElementById("rephrased-summary").innerText = data.rephrased_summary;

                                                // Handle the "Use" button click in the modal
                                                document.getElementById("use-rephrased-summary").onclick = function () {
                                                    document.getElementById("summary-text").value = data.rephrased_summary;
                                                    addOrUpdateSummary();
                                                    modal.style.display = "none";
                                                };

                                                // Handle the "No" button click in the modal
                                                document.getElementById("discard-rephrased-summary").onclick = function () {
                                                    modal.style.display = "none";
                                                }
                                            })
                                            .catch(error => {
                                                console.error('Error:', error);
                                            });
                                    });
                                }

                                function addOrUpdateSummary() {
                                    const summaryText = document.getElementById('summary-text').value;

                                    const data = {
                                        user_id: '{{ user_id }}', // Replace with the actual user ID
                                        summary_text: summaryText
                                    };

                                    fetch('/summary', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(data)
                                    })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            console.log('Summary added/updated:', data);
                                            loadSummaries(); // Reload the summaries after adding/updating
                                            updateSideContainer(); // Update the entire side-container
                                            document.getElementById('change-btn').style.display = 'inline'; // Show the change button
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }


                                // Function to load summaries from the backend
                                function loadSummaries() {
                                    fetch('/summary?user_id={{ user_id }}')
                                        .then(response => response.json())
                                        .then(data => {
                                            const summariesContainer = document.getElementById('summaries');
                                            summariesContainer.innerHTML = '';

                                            if (data.length === 0) {
                                                // If no summaries exist, show the add-summary form
                                                toggleAddSummaryForm();
                                            }

                                            data.forEach(summary => {
                                                const summaryDiv = document.createElement('div');
                                                summaryDiv.id = `summary-${summary.id}`; // Set a unique ID for each summary
                                                summaryDiv.innerHTML = `
                                                                <p>${summary.summary_text}</p>
<button class="delete-btn" onclick="deleteSummary(${summary.id})">Delete</button>
                                                            `;
                                                summariesContainer.appendChild(summaryDiv);
                                            });
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }

                                // Function to toggle the add-summary form visibility
                                function toggleAddSummaryForm() {
                                    const addSummaryForm = document.getElementById('add-summary-form');
                                    const addSummaryButton = document.getElementById('add-summary-button');

                                    if (addSummaryForm.style.display === 'none') {
                                        addSummaryForm.style.display = 'block';
                                        addSummaryButton.style.display = 'none';
                                    } else {
                                        addSummaryForm.style.display = 'none';
                                        addSummaryButton.style.display = 'block';
                                    }
                                }




                                // Function to update a summary
                                function updateSummary(summaryId, updatedSummaryText) {
                                    const data = {
                                        summary_text: updatedSummaryText
                                    };

                                    fetch(`/summary/${summaryId}`, {
                                        method: 'PUT',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(data)
                                    })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadSummaries(); // Reload the summaries after updating
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }


                                // Function to delete a summary
                                function deleteSummary(summaryId) {
                                    fetch(`/summary/${summaryId}`, {
                                        method: 'DELETE'
                                    })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadSummaries(); // Reload the summaries after deleting
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }
                                // Get a reference to the close button
                                const closeButton = document.querySelector('.close');

                                // Add a click event listener to close the modal
                                closeButton.addEventListener('click', function () {
                                    const modal = document.getElementById('rephraseModal');
                                    modal.style.display = 'none';
                                });


                            </script>
                        </div>


                        <!-------------------------WORK EXPERIENCE ----------------------->
                        <div class="section-container">
                            <input type="checkbox" id="toggle-work-experience" class="section-toggle">
                            <label for="toggle-work-experience" class="section-label">
                                <span class="material-symbols-outlined">unfold_more</span>Work Experience
                            </label>
                            <div class="section-content">
                                <div id="work-experience-container">
                                    <!-- Work experiences will be loaded here -->
                                </div>
                                <!-- The Bullet Points Modal -->
                                <div id="bulletPointsModal" class="modal">
                                    <div class="modal-content">
                                        <span class="close" onclick="closeBulletPointsModal()">&times;</span>
                                        <div id="suggested-bullets">
                                            <!-- Suggested bullet points will be loaded here -->
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <button id="add-new-experience"><span class="material-symbols-outlined">
                                            add
                                        </span></button>
                                </div>
                                <div id="enhancedBulletModal" class="modal">
                                    <div class="modal-content">
                                        <span class="close" onclick="closeEnhancedBulletModal()">&times;</span>
                                        <h3 class="modal-title">Enhanced Bullet Point:</h3>
                                        <ul>
                                            <li id="enhanced-text"></li>
                                        </ul>
                                        <button onclick="replaceBulletPoint()"
                                            class="btn btn-success enhanced-modal-button">Replace</button>
                                        <button onclick="closeEnhancedBulletModal()"
                                            class="btn btn-danger enhanced-modal-button">Discard</button>
                                    </div>
                                </div>





                                <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        loadWorkExperiences();
                                        document.getElementById('add-new-experience').addEventListener('click', addNewExperience);
                                    });

                                    function loadWorkExperiences() {
                                        fetch('/work-experience')
                                            .then(response => response.json())
                                            .then(data => {
                                                const container = document.getElementById('work-experience-container');
                                                container.innerHTML = '';
                                                data.forEach(exp => {
                                                    const expDiv = document.createElement('div');
                                                    expDiv.className = 'work-experience';
                                                    expDiv.id = 'work-exp-' + exp.id;
                                                    expDiv.innerHTML = `
                    <p>${exp.job_title} at ${exp.company}</p>
                    <p>From: ${exp.start_date} To: ${exp.end_date}</p>
                    <button class="sparkles-bullets-btn" onclick="fetchSuggestedBullets('${exp.job_title}', ${exp.id})">✨ Need Bullet Ideas?</button>
                    <ul id="bullet-points-${exp.id}">
                        ${exp.bullet_points.map(bp => `
                            <li class="bullet-point">
                                ${bp.text}
                                <span class="material-symbols-outlined close-icon" onclick="deleteBulletPoint(${bp.id}, ${exp.id})">close</span>
                                <span class="material-symbols-outlined sparkles-icon" onclick="enhanceBulletPoint(${bp.id}, ${exp.id}, '${bp.text.replace(/'/g, "\\'")}')">&#x2728;</span>
                            </li>`).join('')}
                    </ul>
                    <button class="add-bullet-exp" onclick="addBulletPoint(${exp.id})">Add Bullet</button>
                    <button class="delete-btn" onclick="deleteWorkExperience(${exp.id})">Delete Experience</button>
                `;
                                                    container.appendChild(expDiv);
                                                });
                                            })
                                            .catch(error => console.error('Error:', error));
                                    }

                                    function enhanceBulletPoint(bulletPointId, experienceId, bulletText) {
                                        if (!bulletText) {
                                            console.error('Bullet text is undefined');
                                            return;
                                        }
                                        fetch('/openai-enhance', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({ text: bulletText })
                                        })
                                            .then(response => {
                                                if (response.status === 403) {
                                                    // Display an alert if the user needs to upgrade to the Premium Plan
                                                    alert("Upgrade required for Premium Plan to use this feature.");
                                                    return;  // Stop further processing
                                                }
                                                if (!response.ok) {
                                                    throw new Error('Network response was not ok');
                                                }
                                                return response.json();
                                            })
                                            .then(data => {
                                                if (data) {
                                                    showEnhancedBulletModal(data.enhanced_text, bulletPointId, experienceId);
                                                }
                                            })
                                            .catch(error => console.error('Error:', error));

                                    }


                                    function addNewExperience() {
                                        const container = document.getElementById('work-experience-container');
                                        const newExpDiv = document.createElement('div');
                                        newExpDiv.className = 'work-experience';
                                        newExpDiv.innerHTML = `
                    <input type="text" id="new-job-title" placeholder="Job Title">
                    <input type="text" id="new-company" placeholder="Company">
                    <input type="date" id="new-start-date">
                    <input type="date" id="new-end-date">
                    <input type="checkbox" id="current-job" onchange="toggleEndDate()"> Present
                    <button class="submit-btn" onclick="submitNewExperience()">Submit New Experience</button>
                `;
                                        container.appendChild(newExpDiv);
                                    }

                                    function submitNewExperience() {
                                        const jobTitle = document.getElementById('new-job-title').value;
                                        const company = document.getElementById('new-company').value;
                                        const startDate = document.getElementById('new-start-date').value;
                                        const isCurrentJob = document.getElementById('current-job').checked;
                                        let endDate = document.getElementById('new-end-date').value;

                                        if (isCurrentJob) {
                                            endDate = 'Present';
                                        }

                                        const data = {
                                            user_id: '{{ user_id }}',
                                            job_title: jobTitle,
                                            company: company,
                                            start_date: startDate,
                                            end_date: endDate
                                        };

                                        fetch('/work-experience', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify(data)
                                        })
                                            .then(response => response.json())
                                            .then(data => {
                                                const newExperienceId = data.id;
                                                loadWorkExperiences(); // This will add the sparkles bullets button
                                                updateSideContainer();

                                                // Fetch the suggested bullet points for the new job title
                                                return fetch('/generate-bullet-points', {
                                                    method: 'POST',
                                                    headers: { 'Content-Type': 'application/json' },
                                                    body: JSON.stringify({ job_title: jobTitle })
                                                })
                                            })
                                            .then(response => {
                                                if (response.status === 403) {
                                                    // Display an alert if the user needs to upgrade to the Premium Plan
                                                    alert("Upgrade to the Premium Tier For AI Generated Content and Resume Assistance.");
                                                    return;  // Stop further processing
                                                }
                                                if (!response.ok) {
                                                    throw new Error('Network response was not ok');
                                                }
                                                return response.json();
                                            })
                                            .then(data => {
                                                if (data) {
                                                    const modal = document.getElementById("bulletPointsModal");
                                                    modal.style.display = "block";
                                                    const bulletsContainer = document.getElementById("suggested-bullets");
                                                    bulletsContainer.innerHTML = '<h3 class="modal-title">Let us help you kick things off. Here are some commonly used bullet points for this role:</h3><ul>';
                                                    data.bullet_points.forEach(bp => {
                                                        bulletsContainer.innerHTML += `<li>${bp} <span class="material-symbols-outlined add-icon" onclick="addBulletToExperience('${bp.replace(/'/g, "\\'")}', ${newExperienceId})">add_circle</span></li>`;
                                                    });
                                                    bulletsContainer.innerHTML += '</ul>';
                                                    bulletsContainer.innerHTML += '<button class="btn btn-danger btn-block close-modal-btn text-white" onclick="closeBulletPointsModal()">Close</button>';
                                                }
                                            })
                                            .catch(error => console.error('Error:', error));

                                    }



                                    function addBulletPoint(experienceId) {
                                        const bulletPointsContainer = document.getElementById(`bullet-points-${experienceId}`);
                                        const inputLi = document.createElement('li');
                                        inputLi.className = 'bullet-point';
                                        inputLi.innerHTML = `
                    <input type="text" id="new-bullet-${experienceId}">
                    <button class="submit-btn" onclick="submitBulletPoint(${experienceId})">Submit Bullet</button>
                `;
                                        bulletPointsContainer.appendChild(inputLi);
                                    }

                                    function submitBulletPoint(experienceId) {
                                        const bulletText = document.getElementById(`new-bullet-${experienceId}`).value;
                                        const data = {
                                            work_experience_id: experienceId,
                                            text: bulletText
                                        };

                                        fetch('/bullet-point', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify(data)
                                        })
                                            .then(response => response.json())
                                            .then(data => {
                                                loadWorkExperiences();
                                                updateSideContainer(); // Update the entire side-container

                                            })
                                            .catch(error => console.error('Error:', error));
                                    }

                                    function deleteWorkExperience(experienceId) {
                                        fetch(`/work-experience/${experienceId}`, { method: 'DELETE' })
                                            .then(response => response.json())
                                            .then(data => {
                                                loadWorkExperiences();
                                                updateSideContainer(); // Update the entire side-container

                                            })
                                            .catch(error => console.error('Error:', error));
                                    }

                                    function deleteBulletPoint(bulletPointId, experienceId) {
                                        fetch(`/bullet-point/${bulletPointId}`, { method: 'DELETE' })
                                            .then(response => response.json())
                                            .then(data => {
                                                loadWorkExperiences();
                                                updateSideContainer(); // Update the entire side-container

                                            })
                                            .catch(error => console.error('Error:', error));
                                    }

                                    function toggleEndDate() {
                                        const endDateInput = document.getElementById('new-end-date');
                                        const isCurrentJob = document.getElementById('current-job').checked;

                                        if (isCurrentJob) {
                                            endDateInput.disabled = true;
                                            endDateInput.value = '';
                                        } else {
                                            endDateInput.disabled = false;
                                        }
                                    }

                                    function addBulletToExperience(bulletText, experienceId) {
                                        const workExperienceContainer = document.getElementById(`work-exp-${experienceId}`);
                                        if (!workExperienceContainer) {
                                            console.error(`Work experience container not found for ID: ${experienceId}`);
                                            return;
                                        }

                                        const bulletPointsList = workExperienceContainer.querySelector(`#bullet-points-${experienceId}`);
                                        if (!bulletPointsList) {
                                            console.error(`Bullet points list not found in work experience container for ID: ${experienceId}`);
                                            return;
                                        }

                                        // Data to be sent to the server
                                        const data = {
                                            work_experience_id: experienceId,
                                            text: bulletText
                                        };

                                        // POST request to add the bullet point to the database
                                        fetch('/bullet-point', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify(data)
                                        })
                                            .then(response => {
                                                if (!response.ok) {
                                                    throw new Error('Network response was not ok');
                                                }
                                                return response.json();
                                            })
                                            .then(data => {
                                                // Add the bullet point to the DOM
                                                const bulletPointItem = document.createElement('li');
                                                bulletPointItem.className = 'bullet-point';
                                                bulletPointItem.innerHTML = `
            ${bulletText}
            <span class="material-symbols-outlined close-icon" onclick="deleteBulletPoint(${data.id}, ${experienceId})">close</span>
            <span class="material-symbols-outlined sparkles-icon" onclick="enhanceBulletPoint(${data.id}, ${experienceId}, '${bulletText.replace(/'/g, "\\'")}')">&#x2728;</span>
        `;
                                                bulletPointsList.appendChild(bulletPointItem);
                                                updateSideContainer(); // Update the entire side-container

                                                // Gray out the selected bullet point in the modal
                                                grayOutSelectedBullet(bulletText);
                                            })
                                            .catch(error => {
                                                console.error('Error:', error);
                                            });
                                    }

                                    // Function to gray out the selected bullet in the modal
                                    function grayOutSelectedBullet(bulletText) {
                                        const bulletsInModal = document.getElementById("suggested-bullets").children;
                                        for (let i = 0; i < bulletsInModal.length; i++) {
                                            const bulletItem = bulletsInModal[i];
                                            const bulletItemText = bulletItem.textContent || bulletItem.innerText;
                                            if (bulletItemText.includes(bulletText)) {
                                                bulletItem.style.color = 'gray';
                                                break; // Stop the loop once the matching bullet point is found
                                            }
                                        }
                                    }



                                    function closeBulletPointsModal() {
                                        const modal = document.getElementById("bulletPointsModal");
                                        modal.style.display = "none";
                                    }

                                    function showEnhancedBulletModal(enhancedText, bulletPointId, experienceId) {
                                        const modal = document.getElementById("enhancedBulletModal");
                                        document.getElementById("enhanced-text").innerText = enhancedText;
                                        modal.style.display = "block";

                                        // Save IDs for use in the replace function
                                        modal.dataset.bulletPointId = bulletPointId;
                                        modal.dataset.experienceId = experienceId;
                                    }

                                    function replaceBulletPoint() {
                                        const modal = document.getElementById("enhancedBulletModal");
                                        const enhancedText = document.getElementById("enhanced-text").innerText;
                                        const bulletPointId = modal.dataset.bulletPointId;
                                        const experienceId = modal.dataset.experienceId;

                                        // Replace the bullet point in the DOM and in the database
                                        // For example:
                                        fetch(`/bullet-point/${bulletPointId}`, {
                                            method: 'PUT',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({ text: enhancedText })
                                        })
                                            .then(response => response.json())
                                            .then(data => {
                                                loadWorkExperiences();
                                                updateSideContainer();
                                                closeEnhancedBulletModal();  // Close the modal after replacement
                                            })
                                            .catch(error => console.error('Error:', error));

                                        modal.style.display = "none";
                                    }

                                    function closeEnhancedBulletModal() {
                                        const modal = document.getElementById("enhancedBulletModal");
                                        modal.style.display = "none";
                                    }
                                    function addSparklesBulletsButton(experienceId, jobTitle) {
                                        const bulletPointsContainer = document.getElementById(`bullet-points-${experienceId}`);
                                        if (bulletPointsContainer) {
                                            const sparklesButton = document.createElement('button');
                                            sparklesButton.className = 'sparkles-bullets-btn';
                                            sparklesButton.innerHTML = '✨ Need Bullet Ideas?';
                                            sparklesButton.onclick = function () {
                                                fetchSuggestedBullets(jobTitle, experienceId);
                                            };
                                            bulletPointsContainer.appendChild(sparklesButton);
                                        }
                                    }


                                    function fetchSuggestedBullets(jobTitle, experienceId) {
                                        fetch('/generate-bullet-points', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({ job_title: jobTitle })
                                        })
                                            .then(response => {
                                                if (response.status === 403) {
                                                    // Display an alert if the user needs to upgrade to the Premium Plan
                                                    alert("Upgrade required for Premium Plan to use this feature.");
                                                    return; // Stop further processing
                                                }

                                                if (!response.ok) {
                                                    throw new Error('Network response was not ok');
                                                }

                                                return response.json();
                                            })
                                            .then(data => {
                                                const modal = document.getElementById("bulletPointsModal");
                                                modal.style.display = "block";
                                                const bulletsContainer = document.getElementById("suggested-bullets");
                                                bulletsContainer.innerHTML = '<h3 class="modal-title">Suggested bullet points for this type of role:</h3><ul>';
                                                data.bullet_points.forEach(bp => {
                                                    bulletsContainer.innerHTML += `<li>${bp} <span class="material-symbols-outlined add-icon" onclick="addBulletToExperience('${bp.replace(/'/g, "\\'")}', ${experienceId})">add_circle</span></li>`;
                                                });
                                                bulletsContainer.innerHTML += '</ul>';
                                                bulletsContainer.innerHTML += '<button class="btn btn-danger btn-block text-white close-modal-btn" onclick="closeBulletPointsModal()">Close</button>';

                                            })
                                            .catch(error => console.error('Error:', error));
                                    }



                                </script>
                            </div>
                        </div>

                        <!-------------------------EDUCATION ----------------------->

                        <div class="section-container">
                            <input type="checkbox" id="toggle-education" class="section-toggle">
                            <label for="toggle-education" class="section-label">
                                <span class="material-symbols-outlined">unfold_more</span>Education
                            </label>
                            <div class="section-content">
                                <div id="education-container">
                                    <!-- Education will be loaded here -->
                                </div>
                                <button id="add-new-education">
                                    <span class="material-symbols-outlined">add</span>
                                </button>
                            </div>

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    loadEducation();
                                    document.getElementById('add-new-education').addEventListener('click', addNewEducation);
                                });

                                function loadEducation() {
                                    return new Promise((resolve, reject) => {
                                        fetch('/education')
                                            .then(response => response.json())
                                            .then(data => {
                                                const container = document.getElementById('education-container');
                                                container.innerHTML = '';
                                                data.forEach(education => {
                                                    const educationDiv = document.createElement('div');
                                                    educationDiv.className = 'education';
                                                    educationDiv.id = 'education-' + education.id;
                                                    educationDiv.innerHTML = `
                        <p>${education.degree}</p>
                        <p>Institution: ${education.institution}</p>
                        <p>Graduation Year: ${education.graduation_year}</p>
                        <button class="delete-btn" onclick="deleteEducation(${education.id})">Delete Education</button>
                    `;
                                                    container.appendChild(educationDiv);
                                                });
                                                resolve(); // Resolve the promise after processing all data
                                            })
                                            .catch(error => {
                                                console.error('Error:', error);
                                                reject(error); // Reject the promise if there is an error
                                            });
                                    });
                                }


                                function addNewEducation() {
                                    const container = document.getElementById('education-container');
                                    const newEducationDiv = document.createElement('div');
                                    newEducationDiv.className = 'education';
                                    newEducationDiv.innerHTML = `
                    <input type="text" id="new-degree" placeholder="Degree">
                    <input type="text" id="new-institution" placeholder="Institution">
                    <input type="text" id="new-graduation-year" placeholder="Graduation Year">
<button class="submit-btn" onclick="submitNewEducation()">Submit New Education</button>
                `;
                                    container.appendChild(newEducationDiv);
                                }

                                function submitNewEducation() {
                                    const degree = document.getElementById('new-degree').value;
                                    const institution = document.getElementById('new-institution').value;
                                    const graduationYear = document.getElementById('new-graduation-year').value;

                                    const data = {
                                        user_id: '{{ user_id }}', // Ensure this is correctly populated
                                        degree: degree,
                                        institution: institution,
                                        graduation_year: graduationYear
                                    };

                                    fetch('/education', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(data)
                                    })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadEducation(); // Reload the education section after adding a new entry
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }


                                function deleteEducation(educationId) {
                                    fetch(`/education/${educationId}`, { method: 'DELETE' })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadEducation(); // Reload the education section after deleting an entry
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }

                            </script>
                        </div>
                        <!-------------------------PROJECTS ----------------------->
                        <div class="section-container">
                            <input type="checkbox" id="toggle-projects" class="section-toggle">
                            <label for="toggle-projects" class="section-label">
                                <span class="material-symbols-outlined">unfold_more</span>Projects
                            </label>
                            <div class="section-content">
                                <div id="project-container">
                                    <!-- Projects will be loaded here -->
                                </div>
                                <button id="add-new-project">
                                    <span class="material-symbols-outlined">add</span>
                                </button>
                            </div>

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    loadProjects();
                                    document.getElementById('add-new-project').addEventListener('click', addNewProject);
                                });

                                function loadProjects() {
                                    return new Promise((resolve, reject) => {
                                        fetch('/projects')
                                            .then(response => response.json())
                                            .then(data => {
                                                const container = document.getElementById('project-container');
                                                container.innerHTML = '';
                                                data.forEach(project => {
                                                    const projectDiv = document.createElement('div');
                                                    projectDiv.className = 'project';
                                                    projectDiv.id = 'project-' + project.id;
                                                    projectDiv.innerHTML = `
                        <p>${project.project_name}</p>
                        <p>Description: ${project.description}</p>
                        <p>URL: ${project.url}</p>
                        <ul id="bullet-points-${project.id}">
                            ${project.bullet_points.map(bp => `
                                <li class="bullet-point-project">
                                    ${bp.text} 
                                    <span class="material-symbols-outlined close-icon" onclick="deleteBulletPoint_project(${bp.id}, ${project.id})">close</span>
                                </li>
                            `).join('')}
                        </ul>
                        <button class="add-bullet-exp" onclick="addBulletPoint_project(${project.id})">Add Bullet</button>
                        <button class="delete-project-btn" onclick="deleteProject_project(${project.id})">Delete Project</button>
                    `;
                                                    container.appendChild(projectDiv);
                                                });
                                                resolve(); // Resolve the promise after processing all data
                                            })
                                            .catch(error => {
                                                console.error('Error:', error);
                                                reject(error); // Reject the promise if there is an error
                                            });
                                    });
                                }


                                function addNewProject() {
                                    const container = document.getElementById('project-container');
                                    const newProjectDiv = document.createElement('div');
                                    newProjectDiv.className = 'project';
                                    newProjectDiv.innerHTML = `
                <input type="text" id="new-project-name" placeholder="Project Name">
                <input type="text" id="new-description" placeholder="Description">
                <input type="text" id="new-url" placeholder="URL">
<button class="submit-btn" onclick="submitNewProject()">Submit New Project</button>
            `;
                                    container.appendChild(newProjectDiv);
                                }

                                function submitNewProject() {
                                    const projectName = document.getElementById('new-project-name').value;
                                    const description = document.getElementById('new-description').value;
                                    const url = document.getElementById('new-url').value;

                                    const data = {
                                        user_id: '{{ user_id }}', // Ensure this is correctly populated
                                        project_name: projectName,
                                        description: description,
                                        url: url
                                    };

                                    fetch('/projects', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(data)
                                    })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadProjects(); // Reload the projects section after adding a new project
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }


                                // Modify the addBulletPoint_project function
                                function addBulletPoint_project(projectId) {
                                    const bulletPointsContainer = document.getElementById(`bullet-points-${projectId}`);
                                    const inputLi = document.createElement('li');
                                    inputLi.className = 'bullet-point-project'; // Use the correct class name
                                    inputLi.innerHTML = `
        <input type="text" id="new-bullet-${projectId}">
    <button class="submit-btn" onclick="submitBulletPoint_project(${projectId})">Submit Bullet</button>
    `;
                                    bulletPointsContainer.appendChild(inputLi);
                                }

                                // Modify the submitBulletPoint_project function
                                function submitBulletPoint_project(projectId) {
                                    const bulletText = document.getElementById(`new-bullet-${projectId}`).value;
                                    const data = {
                                        project_id: projectId,
                                        text: bulletText
                                    };

                                    fetch('/project-bullet-point', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(data)
                                    })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadProjects(); // Reload the projects section after adding a bullet point
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }



                                function deleteProject_project(projectId) {
                                    fetch(`/projects/${projectId}`, { method: 'DELETE' })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadProjects(); // Reload the projects section after deleting a project
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }

                                function deleteBulletPoint_project(bulletPointId, projectId) {
                                    fetch(`/project-bullet-point/${bulletPointId}`, { method: 'DELETE' })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadProjects(); // Reload the projects section after deleting a bullet point
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }

                            </script>
                        </div>

                        <!-------------------------CERTIFICATIONS ----------------------->

                        <div class="section-container">
                            <input type="checkbox" id="toggle-certifications" class="section-toggle">
                            <label for="toggle-certifications" class="section-label"><span
                                    class="material-symbols-outlined">
                                    unfold_more
                                </span>Certifications</label>
                            <div class="section-content">
                                <div class="certifications-header">
                                    <button id="add-new-certification" class="add-certification-button">
                                        <span class="material-symbols-outlined">add</span>
                                    </button>
                                </div>
                                <div id="certifications-container">
                                    <!-- Certifications will be loaded here -->
                                </div>
                            </div>
                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    loadCertifications();
                                    document.getElementById('add-new-certification').addEventListener('click', addNewCertification);
                                });

                                function loadCertifications() {
                                    fetch('/certifications')  // Assuming you have a '/certifications' endpoint
                                        .then(response => response.json())
                                        .then(data => {
                                            const container = document.getElementById('certifications-container');
                                            container.innerHTML = '';
                                            data.forEach(certification => {
                                                const certificationDiv = document.createElement('div');
                                                certificationDiv.className = 'certification';
                                                certificationDiv.id = 'certification-' + certification.id;
                                                certificationDiv.innerHTML = `
                            <p>${certification.certification_name}</p>
                            <p>Issued by: ${certification.issued_by}</p>
                            <p>Issue Date: ${certification.issue_date}</p>
                            <p>Expiration Date: ${certification.expiration_date}</p>
                            <button class="delete-btn" onclick="deleteCertification(${certification.id})">Delete Certification</button>
                        `;
                                                container.appendChild(certificationDiv);
                                            });
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }

                                function addNewCertification() {
                                    const container = document.getElementById('certifications-container');
                                    const newCertificationDiv = document.createElement('div');
                                    newCertificationDiv.className = 'certification';
                                    newCertificationDiv.innerHTML = `
                <input type="text" id="new-certification-name" placeholder="Certification Name">
                <input type="text" id="new-issued-by" placeholder="Issued by">
                <input type="date" id="new-issue-date" placeholder="Issue Date">
                <input type="date" id="new-expiration-date" placeholder="Expiration Date">
<button class="submit-btn" onclick="submitNewCertification()">Submit New Certification</button>
            `;
                                    container.appendChild(newCertificationDiv);
                                }

                                function submitNewCertification() {
                                    const certificationName = document.getElementById('new-certification-name').value;
                                    const issuedBy = document.getElementById('new-issued-by').value;
                                    const issueDate = document.getElementById('new-issue-date').value;
                                    const expirationDate = document.getElementById('new-expiration-date').value;

                                    const data = {
                                        user_id: '{{ user_id }}', // Ensure this is correctly populated
                                        certification_name: certificationName,
                                        issued_by: issuedBy,
                                        issue_date: issueDate,
                                        expiration_date: expirationDate
                                    };

                                    fetch('/certifications', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(data)
                                    })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadCertifications(); // Reload the certifications section
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }


                                function deleteCertification(certificationId) {
                                    fetch(`/certifications/${certificationId}`, { method: 'DELETE' })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            loadCertifications(); // Reload the certifications section
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }

                            </script>
                        </div>


                        <!-------------------------SKILLS ----------------------->
                        <div class="section-container">
                            <input type="checkbox" id="toggle-skills" class="section-toggle">
                            <label for="toggle-skills" class="section-label"><span class="material-symbols-outlined">
                                    unfold_more
                                </span>Skills</label>
                            <div class="section-content">
                                <button id="add-key-skills-btn" class="add-key-skills-btn">✨ Generate Key
                                    Skills</button>
                                <div id="skills-container">
                                    <!-- Skills will be loaded here -->
                                </div>
                                <button class="add-new-skill-btn" id="add-new-skill">Add New Skill</button>
                            </div>
                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    loadSkills();
                                    document.getElementById('add-new-skill').addEventListener('click', addNewSkill);
                                });

                                document.getElementById('add-key-skills-btn').addEventListener('click', async function () {
                                    try {
                                        const response = await fetch('/work-experience');
                                        const experiences = await response.json();
                                        const jobTitles = experiences.map(exp => exp.job_title);

                                        const skillResponse = await fetch('/generate-skills', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({ job_titles: jobTitles })
                                        });
                                        if (skillResponse.status === 403) {
                                            // Display an alert if the user needs to upgrade to the Premium Plan
                                            alert("Upgrade required for Premium Plan to use this feature.");
                                            return;  // Stop further processing
                                        }
                                        if (!skillResponse.ok) {
                                            throw new Error('Failed to generate skills');
                                        }
                                        const skillsResponse = await skillResponse.json();
                                        showSkillsModal(skillsResponse.skills); // Pass only the skills array

                                    } catch (error) {
                                        console.error('Error:', error);
                                    }
                                });

                                function loadSkills() {
                                    fetch('/skills')
                                        .then(response => response.json())
                                        .then(data => {
                                            const container = document.getElementById('skills-container');
                                            container.innerHTML = '';

                                            data.forEach(skill => {
                                                const skillDiv = document.createElement('div');
                                                skillDiv.className = 'skill';

                                                // Display the skill, styled icon for close, and attach the deleteSkill function with the skill's ID
                                                skillDiv.innerHTML = `
                    <span>${skill.skill}</span>
                    <span class="material-symbols-outlined close-icon" onclick="deleteSkill(${skill.id})">close</span>
                `;

                                                container.appendChild(skillDiv);
                                            });
                                        });
                                }


                                function addNewSkill() {
                                    const container = document.getElementById('skills-container');
                                    const newSkillDiv = document.createElement('div');
                                    newSkillDiv.className = 'skill';
                                    newSkillDiv.innerHTML = `
        <textarea id="new-skill" class="skill-textarea" placeholder="Enter skills separated by commas or new lines"></textarea>
        <button class="submit-new-skills-btn" onclick="submitNewSkills()">Submit New Skills</button>
    `;
                                    container.appendChild(newSkillDiv);
                                }

                                async function submitNewSkills() {
                                    const skillsInput = document.getElementById('new-skill').value;
                                    const skills = skillsInput.split(/,|\n/).map(skill => skill.trim()).filter(skill => skill.length > 0);

                                    for (const skill of skills) {
                                        const data = { skill: skill };

                                        try {
                                            const response = await fetch('/skills', {
                                                method: 'POST',
                                                headers: { 'Content-Type': 'application/json' },
                                                body: JSON.stringify(data)
                                            });

                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }

                                            await response.json();
                                            console.log('Skill added:', skill);
                                        } catch (error) {
                                            console.error('Error:', error);
                                        }
                                    }

                                    await loadSkills(); // Reload skills after adding
                                    updateSideContainer(); // Update the entire side-container
                                }

                                function deleteSkill(skillId) {
                                    fetch(`/skills/${skillId}`, { method: 'DELETE' })
                                        .then(response => {
                                            if (!response.ok) {
                                                throw new Error('Network response was not ok');
                                            }
                                            return response.json();
                                        })
                                        .then(async data => {
                                            console.log('Skill deleted:', skillId);
                                            await loadSkills(); // Reload the skills section
                                            updateSideContainer(); // Update the entire side-container
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });
                                }


                                async function addSkillToDom(skill) {
                                    // Create a new skill element
                                    const skillDiv = document.createElement('div');
                                    skillDiv.className = 'skill';
                                    skillDiv.innerHTML = `
        <span>${skill}</span>
        <span class="material-symbols-outlined close-icon" onclick="deleteSkill('loading...')">close</span>
    `;

                                    // Add this new skill to the skills container
                                    const container = document.getElementById('skills-container');
                                    container.appendChild(skillDiv);

                                    // Save the new skill to the database
                                    try {
                                        const response = await fetch('/skills', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({ skill: skill })
                                        });

                                        if (!response.ok) {
                                            throw new Error('Network response was not ok');
                                        }

                                        // Update the skill element with the new ID
                                        const responseData = await response.json();
                                        skillDiv.querySelector('.close-icon').setAttribute('onclick', `deleteSkill(${responseData.id})`);

                                        console.log('Skill added:', skill);
                                    } catch (error) {
                                        console.error('Error:', error);
                                    }

                                    // Update the entire side-container
                                    updateSideContainer();
                                }


                                function showSkillsModal(skills) {
                                    // Create a modal container if it doesn't exist
                                    let modal = document.getElementById('skills-modal');
                                    if (!modal) {
                                        modal = document.createElement('div');
                                        modal.id = 'skills-modal';
                                        modal.className = 'modal';
                                        document.body.appendChild(modal);
                                    }

                                    // Modal content
                                    let modalContent = `
  <div class="modal-content">
    <span class="close-modal" style="font-size: 40px;">&times;</span>
    <h2>Select Skills</h2>
    <div class="skills-list">`;


                                    // Add skills to the modal
                                    skills.forEach(skill => {
                                        modalContent += `
<div class="skill-item">
    ${skill}
    <span class="material-symbols-outlined add-skill-icon" onclick="addSkillToDom('${skill}')">
        add_circle
    </span>
</div>`;

                                    });
                                    modalContent += `</div><div style="margin-top: 10px;"><button type="button" class="btn btn-danger close-modal">Close</button></div>`;
                                    modal.innerHTML = modalContent;


                                    // Show the modal
                                    modal.style.display = 'block';

                                    // Close modal on clicking the close button
                                    modal.querySelectorAll('.close-modal').forEach(button => {
                                        button.onclick = function () {
                                            modal.style.display = 'none';
                                        };
                                    });
                                }


                            </script>

                        </div>
                        <div>
                            <p class="preview-notice">Note: The Preview represents a dynamic preview of your resume as
                                you build
                                it
                                using our resume
                                builder. It is designed to give you an idea of how your content is being arranged and
                                displayed.

                                Please note that this is just a preview, and depending on the screen size of the device
                                you're using to build your
                                resume, may not reflect the final formatting and
                                layout
                                of
                                your resume.
                                For a fully formatted and correctly sized version of your resume, generate a PDF by
                                clicking the
                                PDF icon above the Preview area. This will create a polished, professional PDF version
                                of your resume,
                                optimized for
                                printing and
                                sharing with potential employers.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!------------------------ Side Rectangle Container ---------------------------------------->
            <div class="col-md-8">

                <!-- Icon to View Resume as PDF -->
                <div class="generate-icon-container" style="display: table; width: 100%;">
                    <div style="display: table-cell; vertical-align: middle; text-align: center;">
                        <span style="font-size: 2em; color: white; margin-right: 4px; font-weight: bold;">Click to
                            Generate</span>
                        <span class="material-symbols-outlined view-resume-icon"
                            onclick="window.open('/download_resume_pdf', '_blank')">
                            picture_as_pdf
                        </span>
                    </div>
                </div>













                <div class="side-container" style="border: 1px solid #000; border-top: 3px solid #000; height: 600px;">
                    <!-- Including the resume template here -->
                    <div>{% include 'resume.html' %}</div>
                </div>
            </div>

        </div>
    </div>
    </div>
    {% else %}
    <!-- Content for users who are not authenticated -->
    <p>Please log in to access your resume data.</p>
    <a href="/login" class="btn btn-primary">Log In</a>
    {% endif %}

    <!-- 
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    -->

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

</body>

</html>