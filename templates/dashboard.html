<html lang="en">

<head>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Satisfy&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@500&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@500&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Ultra&amp;display=swap" rel="stylesheet" />
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>myDashboard | myCareerMax</title>'
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>'
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        .table-container {
            margin-bottom: 50px;
        }

        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24
        }

        .satisfy-font {
            font-family: 'Satisfy', cursive;
            color: #ffffff;
            /* Set the text color to white */
        }


        .logo-container {
            text-align: center;
            margin-top: 20px;
        }

        .responsive-logo {
            max-width: 100%;
            /* Ensures the image doesn't stretch beyond its container */
            height: auto;
            /* Maintains the image's aspect ratio */
            display: inline-block;
            /* To make it work with the text-align of the parent */
        }

        /* New styles for green text */
        .green-text,
        .green-text .nav-link,
        .green-text .navbar-brand {
            color: #007BFF !important;
        }

        /* Added styles for horizontal scrolling */
        #saved-jobs-container {
            display: flex;
            /* make it a flex container */
            overflow-x: auto;
            /* enable horizontal scrolling */
            white-space: nowrap;
            /* prevent wrapping of cards */
        }

        .card {
            flex: 0 0 auto;
            /* prevent cards from growing or shrinking */
            max-width: 300px;
            /* Set a max width for job cards */





            margin-right: 10px;
            /* spacing between cards */
            white-space: normal;
            /* Make sure the content wraps within the card */
        }

        body {
            font-family: 'Prompt', sans-serif;
            background-image: linear-gradient(120deg, #b700ff, #3776ff);
            background-size: cover;
            background-attachment: fixed;
        }

        /* Updated styles for leaderboard container */
        #leaderboard-container {
            width: 100%;
            overflow-x: auto;
            background-color: #ffffff;
            /* Making the background white */
            border-radius: 12px;
            /* Adding rounded corners */
            overflow: hidden;
            /* Ensuring the content respects the rounded corners */
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        @media screen and (max-width: 600px) {

            th,
            td {
                font-size: 14px;
            }
        }

        .navbar {
            background-image: linear-gradient(120deg, #ffffff, #ffffff);
            background-size: cover;
            background-attachment: fixed;
        }

        .percentage {
            font-family: 'Ultra', serif;
            color: #24c700;
            font-size: 20px;
        }

        .percentage {
            position: absolute;
            top: 2px;
            right: 2px;
        }

        .job-title {
            font-family: 'Varela Round', sans-serif;
            font-size: x-large;
            color: blue;
            text-align: center;
            display: flex;
            align-items: center;
            /* Center vertically */
            justify-content: center;
            /* Center horizontally */
            width: 100%;
            /* Ensure it takes full width */
        }

        .company-name {
            font-family: 'Kanit', sans-serif;
            font-size: larger;
            /* changed from 'large' to 'smaller' */
            color: rgb(0, 0, 174);
            text-align: center;
            display: flex;
            align-items: center;
            /* Center vertically */
            justify-content: center;
            /* Center horizontally */
            width: 100%;
            /* Full width to capture overflow */
        }

        .status select {
            font-size: 18px;
            padding: 4px;
        }


        .status {
            margin-bottom: 10px;
            /* Add some space below the dropdown */
        }

        .status-row-header {
            font-size: 20px;
            font-family: 'Noto Sans', sans-serif;
            margin-bottom: 10px
        }

        .status-row-header {
            color: #ffffff;
            text-align: center;
        }

        .job-cards-row {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            /* Remove fixed height */
        }

        .job-card {
            flex: 0 0 auto;
            width: 400px;
            padding: 15px;
            margin: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgb(0, 0, 0);
            cursor: pointer;
            position: relative;
            background: linear-gradient(to right, rgb(255, 255, 255), rgb(255, 255, 255));
            /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        }


        .job-card {
            position: relative;
        }

        .employer-logo {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 35px;
            height: 35px;
        }

        .job-card-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100%;
            /* Change to min-height */
        }

        .white-text {
            color: white;
            margin-bottom: 10px;
            margin-top: 15px;
        }

        /* Modal styles */
        /* Existing styles for larger screens, keep them as they are */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #000000;
            width: 80%;
        }

        /* New styles for mobile screens */
        @media screen and (max-width: 768px) {
            .modal-content {
                margin: 5% auto;
                width: 95%;
                height: auto;
                overflow-y: auto;
            }
        }

        /* Additional modal styles */
        .modal-header2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }


        /* Updated .percentage class */
        .percentage2 {
            font-family: 'Ultra', serif;
            color: #24c700;
            font-size: 40px;
        }

        /* Updated apply-button */
        .apply-link2 {
            font-size: 24px;
            text-decoration: none;
            color: blue;
            display: inline-block;
        }

        .modal-body2 {
            text-align: left;
        }

        .status2,
        .employer-logo2,
        .percentage2 {
            text-align: center;
            margin-top: 10px;
        }

        .employer-logo2 {
            height: auto;
            width: auto;
        }


        .job-description2,
        .keywords2 {
            text-align: left;
            margin-top: 10px;
        }

        /* Updated close button styles */
        .close {
            font-size: 32px;
            /* Increased size */
            color: red;
            cursor: pointer;
            line-height: 32px;
            /* Match line-height with font-size for better alignment */
            margin-top: 5px;
            margin-right: 5px;
        }

        .status2 {
            margin-bottom: 35px;
            font-size: 24px;
            color: rgb(85, 0, 255);
        }

        .job-title2 {
            margin-bottom: 10px;
            font-size: 24px;
            color: blue;
            font-weight: bold;
        }

        .company-name2 {
            margin-bottom: 20px;
            font-size: 20px;
            color: rgb(85, 0, 255);
            font-weight: bold;
        }

        /* Add custom styles for the button */
        .styled-button {
            display: inline-block;
            padding: 10px 20px;
            background-image: linear-gradient(to bottom, #b700ff, #3776ff);
            color: white;
            border-color: #ffffff;
            text-decoration: none;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            margin-top: 30px;
            font-weight: bold;
            box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.8);
            transition: background-color 0.3s, color 0.3s;
        }

        /* Hover effect: Lighten the background color on hover */
        .styled-button:hover {
            background-image: linear-gradient(to bottom, #a000e0, #2960e0);
            color: white;
        }


        .icon-shadow {
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            /* Adjust the shadow as needed */
            border-radius: 4px;
            /* Optional: Adds rounded corners */
            display: inline-block;
            /* To ensure box shadow applies correctly to span */
            padding: 4px;
            /* Optional: Adds some space around the icon */
            cursor: pointer;
            /* Changes the cursor to a pointer to indicate it's clickable */
        }

        .white-text {
            color: white;
            margin-bottom: 5px;
        }
    </style>
</head>
<script defer>
    $(document).ready(function () {
        console.log("Fetching username...");
        $.get("/get-username", function (response) {
            console.log("Username response:", response);
            if (response.success) {
                const usernamePlaceholder = document.getElementById("username-placeholder");
                usernamePlaceholder.textContent = "Hello, " + response.username;
            } else {
                console.error('Error fetching username:', response.error);
            }
        });
    });
</script>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="https://www.mycareermax.com" style="color: #003c86;">myCareerMax.com</a>
        <button aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"
            data-target="#navbarNav" data-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <!-- Existing dropdown for the username -->
                <li class="nav-item dropdown">
                    <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle"
                        data-toggle="dropdown" href="#" id="navbarDropdown" role="button" style="color: #003c86;">
                        <span id="username-placeholder">Login Here</span>
                    </a>
                    <div aria-labelledby="navbarDropdown" class="dropdown-menu">
                        <a class="dropdown-item" href="/dashboard#my-docs" style="color: #003c86;">My AI Docs</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/login" style="color: #00b018;">Login</a>
                        <a class="dropdown-item" href="/logout" style="color: #0d00ff;">Logout</a>
                        <a class="dropdown-item" href="/delete_account" style="color: #ff0000;">Delete Account</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/dashboard" style="color: #003c86;">myDashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/search" style="color: #003c86;">AI Job Search</a>
                </li>
                <!-- Tools Dropdown -->
                <li class="nav-item dropdown">
                    <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle"
                        data-toggle="dropdown" href="#" id="toolsDropdown" role="button" style="color: #003c86;">
                        Tools
                    </a>
                    <div aria-labelledby="toolsDropdown" class="dropdown-menu">
                        <a class="dropdown-item" href="/resume-report" style="color: #003c86;">Resume Report</a>
                        <a class="dropdown-item" href="/interview-prep" style="color: #003c86;">Interview Prep</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/create" style="color: #003c86;">Createâœ¨</a>
                </li>
                <!-- New link for CareerBot -->
                <li class="nav-item">
                    <a class="nav-link" href="/careerbot" style="color: #003c86;">Max</a>
                </li>
                <!-- End of Dropdown for username -->
            </ul>
        </div>
    </nav>

    <div style="text-align:center;">
        <img alt="Your Logo" src="{{ url_for('static', filename='images/white-mycareermax.png') }}"
            style="max-width:100%;" />
        <div class="container mt-5"
            style="background-color: #000000; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); margin-bottom: 20px; padding: 10px;">
            <div class="text-center white-text">
                <!-- White Text Message with CSS class -->
                <div style="font-size: 24px; margin-bottom: 25px">What's New?</div>
                <div style="text-align: left;">
                    <p>
                        We're thrilled to introduce significant enhancements to our platform:
                    </p>
                    <ul style="margin-top: 0; padding-top: 0;">
                        <li style="margin-bottom: 15px;"> <span
                                style="background-color: #3300ff; color: white; border-radius: 10px; padding: 3px;">Redesigned
                                Dashboard with
                                New Job Tracker:</span> Our dashboard has undergone a comprehensive redesign,
                            introducing a
                            sophisticated Job Tracker tool. This upgrade
                            enhances the job management experience by integrating the previously separate Saved Jobs
                            section. All your saved jobs
                            are automatically added to the tracker, with an advanced feature that analyzes job
                            descriptions
                            to provide a
                            compatibility match score for each job. This allows you to efficiently track positions
                            you've
                            applied for and closely
                            monitor your progress through each stage of the interview process, while also understanding
                            how
                            well your skills and
                            experience align with each role.
                            <a href="/dashboard#my-docs"
                                style="background-color: white; color: blue; padding: 3px; border-radius: 10px; text-decoration: underline;">Check
                                it out here</a>
                        </li>

                        <li style="margin-bottom: 15px;"> <span
                                style="background-color: #3300ff; color: white; border-radius: 10px; padding: 3px;">Enhanced
                                Job Search
                                Interface:</span> Experience a comprehensive UI transformation on our job search page,
                            designed to present vital
                            information at first glance. This update includes advanced features like efficient filtering
                            options, seamless
                            infinite scrolling, and personalized document management for each job listing, streamlining
                            the
                            entire job search
                            process. Discover the improved functionality and user experience on our
                            <a href="/search">
                                <span
                                    style="background-color: white; color: blue; border-radius: 10px; padding: 3px; text-decoration: underline;">new
                                    Job Search page</span>
                            </a>.
                        </li>

                        <li style="margin-bottom: 15px;"> <span
                                style="background-color: #3300ff; color: white; border-radius: 10px; padding: 3px;">Revamped
                                Resume
                                Builder:</span> This intuitive tool guides users through each step of resume creation,
                            offering a real-time
                            preview for instant edits and refinements. As you craft your resume, see how each addition
                            or
                            modification appears.
                            The builder is further enhanced with ChatGPT4's suggestions for summaries, skills, and
                            bullet
                            points, which users
                            can choose to incorporate. This feature accelerates the resume-building process and ensures
                            inclusion of key
                            elements sought by ATS systems. Experience the upgraded Resume Builder
                            <a href="/ai-builder">
                                <span
                                    style="background-color: white; color: blue; border-radius: 10px; padding: 3px; text-decoration: underline;">Here</span>
                            </a>.
                        </li>
                        <li style="margin-bottom: 15px;"> <span
                                style="background-color: #3300ff; color: white; border-radius: 10px; padding: 3px;">New
                                myCareerMax Resume
                                Report:</span> Elevate your job application with our groundbreaking myCareerMax Resume
                            Report. This innovative
                            feature meticulously analyzes your uploaded resume, providing a detailed assessment of its
                            compatibility with
                            Applicant Tracking Systems (ATS). Gain invaluable insights with a comprehensive
                            section-by-section breakdown,
                            complete with feedback and individual scoring. We offer an overall ATS optimization
                            percentage
                            score, pinpointing
                            the strengths and areas for improvement. Additionally, the report furnishes a concise
                            summary of
                            the analysis,
                            accentuating key observations, and extracts a list of pivotal keywords recognized by ATS.
                            What's
                            more, receive a
                            tailored list of recommended actions to boost your resume's ATS score, ensuring it's
                            fine-tuned
                            for success in any
                            ATS. Transform your resume into a powerful tool in your job search arsenal with myCareerMax
                            Resume Report.
                            <a href="/resume-report"
                                style="background-color: white; color: blue; padding: 3px; border-radius: 10px; text-decoration: underline;">Get
                                Your Free ATS Score Now</a>
                        </li>

                    </ul>

                    <!-- New ATS Optimized Resume Builder Link -->
                    <p>
                        Get started by uploading your resume to your profile. If you would like a resume refresh or need
                        to
                        create a new
                        resume,
                        <span style="background-color: white; border-radius: 5px; padding: 2px 4px;">
                            <a href="/resume-builder" style="color: blue; text-decoration: underline;">click here</a>
                        </span>
                        to access our New ATS Optimized Resume Builder.
                    </p>
                </div>

                <!-- View My Profile Button -->
                <a href="{{ url_for('myprofile') }}" class="styled-button">View My Profile</a>
            </div>
        </div>






        <script>

            // Fetch the user's documents and populate the list
            $.get("/get_user_documents", function (data) {
                data.forEach(function (doc) {
                    let downloadLinks = "";

                    if (doc.Document === "Custom Cover Letter" || doc.Document === "Cover Letter (Cover Letter Builder)") {
                        downloadLinks += `
                <li class="list-group-item">
                    <a href="/download_document/${doc.id}?format=docx">
                        <img src="/static/images/docx.svg" alt="Download DOCX" class="icon-shadow" width="24" height="24">
                    </a>
                </li>
            `;
                        downloadLinks += `
                <li class="list-group-item">
                    <a href="/download_document/${doc.id}?format=pdf">
                        <img src="/static/images/pdf.svg" alt="Download PDF" class="icon-shadow" width="24" height="24">
                    </a>
                </li>
            `;
                    } else if (doc.Document === "Tailored Resume" || doc.Document === "Resume (Resume Builder)") {
                        downloadLinks += `
                <li class="list-group-item">
                    <a href="/download_html2pdf/${doc.id}?format=pdf">
                        <img src="/static/images/pdf.svg" alt="Download PDF" class="icon-shadow" width="24" height="24">
                    </a>
                </li>
            `;
                    }

                    $("#saved-documents-list").append(downloadLinks);
                });
            });

        </script>
        <div class="table-container" style="background-color: white; padding: 20px; border-radius: 10px;">
            <h2 style="color: #007BFF;">My Docs</h2>
            <div class="table-responsive" id="my-docs">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Apply Link</th>
                            <th>Document</th>
                            <th>Job Title</th>
                            <th>Company Name</th>
                            <th>Interview Prep</th>
                            <th>Download DOCX</th>
                            <th>Download PDF</th>
                            <th>Delete</th>
                            <th>Creation Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for doc in documents %}
                        <tr>
                            <!-- Updated Apply Link with Icon -->
                            <td>
                                <a href="{{ doc.apply_link }}" target="_blank">
                                    <span class="material-symbols-outlined icon-shadow">contract_edit</span>
                                </a>
                            </td>

                            <td>{{ doc.document_type }}</td>
                            <td>{{ doc.job_title }}</td>
                            <td>{{ doc.company_name }}</td>
                            <td>
                                <a href="/interview-prep" target="_blank">
                                    <span class="material-symbols-outlined icon-shadow">
                                        partner_exchange
                                    </span>
                                </a>
                            </td>

                            <!-- DOCX Download Link -->
                            <td>
                                {% if doc.document_type == 'Custom Cover Letter' or doc.document_type == 'Cover
                                Letter
                                (Cover
                                Letter Builder)' %}
                                <a href="{{ url_for('download_document', document_id=doc.id, format='docx') }}">
                                    <img src="/static/images/docx.svg" alt="Download DOCX" class="icon-shadow"
                                        width="24" height="24">
                                </a>
                                {% else %}
                                &nbsp; <!-- No DOCX download for resumes -->
                                {% endif %}
                            </td>

                            <!-- PDF Download Link -->
                            <td>
                                {% if doc.document_type == 'Tailored Resume' or doc.document_type == 'Resume (Resume
                                Builder)'
                                %}
                                <a href="{{ url_for('download_html2pdf', document_id=doc.id, format='pdf') }}">
                                    <img src="/static/images/pdf.svg" alt="Download PDF" class="icon-shadow" width="24"
                                        height="24">
                                </a>
                                {% elif doc.document_type == 'Custom Cover Letter' or doc.document_type == 'Cover
                                Letter
                                (Cover
                                Letter Builder)' %}
                                <a href="{{ url_for('download_document', document_id=doc.id, format='pdf') }}">
                                    <img src="/static/images/pdf.svg" alt="Download PDF" class="icon-shadow" width="24"
                                        height="24">
                                </a>
                                {% endif %}
                            </td>

                            <!-- Delete Button -->
                            <td>
                                <span class="material-symbols-outlined icon-shadow"
                                    onclick="deleteDocument({{ doc.id }})">
                                    delete
                                </span>
                            </td>
                            <!-- Creation Date -->
                            <td>{{ doc.creation_date }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>



        <script>
            function deleteDocument(documentId) {
                if (confirm("Are you sure you want to delete this document?")) {
                    $.ajax({
                        url: '/delete_document/' + documentId,
                        type: 'DELETE',
                        success: function (response) {
                            if (response.success) {
                                alert('Document deleted successfully!');
                                location.reload(); // Reload the page to update the table
                            } else {
                                alert('Error deleting document. Please try again.');
                            }
                        }
                    });
                }
            }
        </script>
</body>

{% for status, jobs in saved_jobs_by_status.items() %}
{% if jobs|length > 0 %} {# Check if there are jobs under this status #}
<div class="status-row-header" id="status-header-{{ status|lower }}">
    <h2>{{ status }}</h2>
</div>
<div class="job-cards-row">
    {% for job in jobs %}
    <!-- Debug: Print out the job variable -->
    <script>
        console.log("Current job in loop:", {{ job | tojson | safe}});
    </script>
    <div class="job-card" data-job='{{ job|tojson|safe }}' onclick="showModal(this)">
        <img src="{{ url_for('static', filename='images/default_logo.png') }}" alt="Default Logo" class="employer-logo">
        <div class="job-card-content">
            <div class="status">
                <select data-job-id="{{ job.id }}" onchange="updateStatus(this, event);"
                    onclick="stopPropagation(event);">
                    <option value="Saved" {% if job.status=='Saved' %}selected{% endif %}>Saved</option>
                    <option value="Applied" {% if job.status=='Applied' %}selected{% endif %}>Applied</option>
                    <option value="Interviewing" {% if job.status=='Interviewing' %}selected{% endif %}>
                        Interviewing
                    </option>
                    <option value="Offered" {% if job.status=='Offered' %}selected{% endif %}>Offered</option>
                    <option value="Rejected" {% if job.status=='Rejected' %}selected{% endif %}>Rejected
                    </option>
                    <option value="Delete" {% if job.status=='Delete' %}selected{% endif %}>Delete</option>
                </select>
            </div>
            <div class="job-title">{{ job.job_title }}</div>
            <div class="company-name">{{ job.company_name }}</div>
        </div>
        <div class="percentage">{{ job.percentage }}%</div>
    </div>


    {% endfor %}
</div>
{% endif %} {# Close the if block here #}
{% endfor %}
<script>
    var currentUserId = "{{ current_user.id }}";
</script>

<script>
    function stopPropagation(e) {
        e.stopPropagation();
    }
</script>
<script>
    console.log("Job cards loaded.");
</script>
<!-- Modal -->
<div id="jobModal" class="modal">
    <div class="modal-content">
        <div id="modalData"></div>
    </div>
</div>
<script>
    console.log("Modal section loaded.");
</script>
<script>
    // Modified showModal function with debugging lines
    function showModal(element) {
        console.log("showModal function called.");

        const rawData = element.getAttribute('data-job').trim();
        console.log("Raw data-job attribute:", rawData);

        let jobData;
        try {
            jobData = JSON.parse(rawData);
        } catch (e) {
            console.error("Error parsing job data:", e);
            return;
        }

        console.log("Parsed job data:", jobData);

        let modal = document.getElementById("jobModal");
        let modalData = document.getElementById("modalData");

        let defaultLogoPath = "/static/images/default_logo.png";  // Adjust the path as needed
        let employerLogoHtml = jobData.employer_logo ?
            `<img src="${jobData.employer_logo}" alt="Employer Logo" width="100" height="100" onerror="this.onerror=null; this.src='${defaultLogoPath}';">` :
            `<img src="${defaultLogoPath}" alt="Default Logo" width="100" height="100">`;

        modalData.innerHTML = `
        <div class="modal-header2">
            <span class="material-symbols-outlined close" onclick="closeModal()">close</span>
            <span class="material-symbols-outlined apply-button2"><a href="${jobData.job_link}" class="apply-link2">arrow_outward</a></span>        </div>
        <div class="modal-body2">
            <div class="percentage2">${jobData.percentage}%</div>
            <div class="employer-logo2">${employerLogoHtml}</div>
            <div class="status2">${jobData.status}</div>
            <div class="job-title2">${jobData.job_title}</div>
            <div class="company-name2">${jobData.company_name}</div>
            <div class="job-description2"><strong>Job Summary:</strong>  ${jobData.job_description}</div>
<div class="keywords2"><strong>Keywords Extracted From Job Description:</strong>  ${jobData.keywords_resume}</div>
        </div>
    `;




        modal.style.display = "block";
        console.log("Modal displayed.");
    }



    function closeModal() {
        console.log("closeModal function called.");
        let modal = document.getElementById("jobModal");
        modal.style.display = "none";
        console.log("Modal closed.");
    }
</script>
<script>
    console.log("All scripts loaded.");
</script>
<script>
    function updateStatus(selectElement, event) {
        // Stop propagation to prevent showModal
        event.stopPropagation();

        const jobId = selectElement.getAttribute('data-job-id');
        const newStatus = selectElement.value;
        const userId = currentUserId;  // Assuming currentUserId is globally available

        console.log(`Job ID: ${jobId}, New Status: ${newStatus}`);  // Debugging line

        if (newStatus === 'Delete') {
            console.log('Attempting to delete job');  // Debugging line

            if (window.confirm('Are you sure you want to delete this job?')) {
                fetch('/remove-saved-job', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        job_id: jobId,
                    }),
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log('Job successfully deleted');  // Debugging line
                            selectElement.closest('.job-card').remove();
                        } else {
                            alert('Failed to delete job: ' + data.error);
                        }
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        } else {
            fetch('/update-job-status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    new_status: newStatus,
                    job_id: jobId,
                    user_id: userId  // This is usually not needed if you can identify the user on the server
                }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Failed to update job status: ' + data.error);
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
    }

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        // Debugging for when the modal is shown
        $('#resumeModal').on('shown.bs.modal', function () {
            console.log('Modal is displayed');

            // Check if there's more than one backdrop present
            if ($('.modal-backdrop').length > 1) {
                console.log('Multiple backdrops detected!');
                // Remove any extra backdrops, if necessary
                $('.modal-backdrop').not(':first').remove();
            }

            // Check z-index of the modal
            var modalZIndex = $(this).css('z-index');
            console.log('Modal z-index:', modalZIndex);

            // Check z-index of the backdrop
            var backdropZIndex = $('.modal-backdrop').css('z-index');
            console.log('Backdrop z-index:', backdropZIndex);

            // Ensure the modal z-index is higher than the backdrop's
            if (parseInt(modalZIndex) <= parseInt(backdropZIndex)) {
                console.log('Adjusting modal z-index to be on top of the backdrop');
                $(this).css('z-index', parseInt(backdropZIndex) + 10);
            }
        });
    });
</script>

</body>

</html>