<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>AI Job Search | myCareerMax</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2305706078196748"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Popper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>


    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300&display=swap" rel="stylesheet">

    <style>
        .pro-tip-box {
            background-color: #e7e7e7;
            /* Light grey background */
            border: 1px solid #007BFF;
            /* Grey border */
            border-radius: 12px;
            /* Rounded corners */
            padding: 16px;
            /* Padding */
            width: 100%;
            /* Full width */
            box-sizing: border-box;
            /* Make sure padding and width stay in place */
            margin-bottom: 16px;
            /* Bottom margin */
            color: #007BFF;
            /* Dark grey text */

        }

        @media (max-width: 768px) {
            .pro-tip-box {
                font-size: 14px;
                /* Smaller text on mobile */
            }
        }

        body {
            background-color: #ffffff;
        }

        body {
            font-family: 'Prompt', sans-serif;
            margin: 0;
            padding: 0;
        }

        .job-box-btn {
            display: inline-block;
            vertical-align: middle;
            margin-top: -5px;
        }

        .job-box {
            background-color: #d2e3ff;
            border: 1px solid #ccc;
            padding: 15px;
            margin: 10px;
            position: relative;
            overflow: hidden;
            max-height: 300px;
            overflow-y: auto;
        }

        .job-box:hover {
            background-color: #f5f5f5;
        }

        .job-box.active {
            overflow-y: auto;
            max-height: 500px;
        }

        .navbar {
            background-image: linear-gradient(120deg, #6b9aff, #f1f1f1);
            background-size: cover;
            background-attachment: fixed;
        }


        nav {
            display: flex;
            justify-content: center;
            list-style: none;
            padding: 0;
        }

        nav li {
            margin: 0 15px;
        }

        nav a {
            color: rgb(0, 0, 0);
            text-decoration: none;
        }
    </style>
</head>

<body>

    <script defer>

        $(document).ready(function () {
            console.log("Fetching username...");
            $.get("/get-username", function (response) {
                console.log("Username response:", response);
                if (response.success) {
                    const usernamePlaceholder = document.getElementById("username-placeholder");
                    usernamePlaceholder.textContent = "Hello, " + response.username;
                } else {
                    console.error('Error fetching username:', response.error);
                }
            });
        });
    </script>

    <nav class="navbar navbar-expand-lg navbar-light bg-light" style="margin-right: 20px;">
        <a class="navbar-brand" href="https://www.mycareermax.com" style="color: #003c86;">myCareerMax.com</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/careerclick" style="color: #003c86;">AI Job Search</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/cover-letter-generator" style="color: #003c86;">AI Cover Letter</a>
                </li>
                <!-- Dropdown Menu for AI Resume Tools -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="resumeDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color: #003c86;">
                        AI Resume Tools
                    </a>
                    <div class="dropdown-menu" aria-labelledby="resumeDropdown">
                        <a class="dropdown-item" href="/resume-enhancer" style="color: #003c86;">Resume Scanner</a>
                        <a class="dropdown-item" href="/ai-builder" style="color: #003c86;">AI Resume Builder</a>
                    </div>
                </li>
                <!-- End of Dropdown -->
                <li class="nav-item">
                    <a class="nav-link" href="/interview-prep" style="color: #003c86;">Interview Prep</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/dashboard" style="color: #003c86;">myDashboard</a>
                </li>
                <!-- Existing dropdown for the username -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color: #003c86;">
                        <span id="username-placeholder">Login Here</span>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="/dashboard#my-docs" style="color: #003c86;">My AI Docs</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/login" style="color: #00b018;">Login</a>
                        <a class="dropdown-item" href="/logout" style="color: #0d00ff;">Logout</a>
                        <a class="dropdown-item" href="/delete_account" style="color: #ff0000;">Delete Account</a>
                    </div>
                </li>
                <!-- End of Dropdown for username -->
            </ul>
        </div>
    </nav>


    <script>
        console.log("jQuery version:", $().jquery);
        console.log("Bootstrap:", typeof ($.fn.modal));
    </script>

</body>

<body>
    <div style="text-align:center;">
        <img src="{{ url_for('static', filename='images/blue-mycareermax.png') }}" alt="Your Logo"
            style="max-width:100%;" />
    </div>
    <div class="container mt-5">
        <!-- Job Search Section -->
        <div class="mb-4" id="job-search-section">
            <div class="form-row">
                <div class="col">
                    <input class="form-control" id="job-query" placeholder="Job title, e.g., Python Developer"
                        type="text" />
                </div>
                <div class="col">
                    <input class="form-control" id="job-location" placeholder="Location, e.g., Texas, USA"
                        type="text" />
                </div>
                <div class="col">
                    <button class="btn btn-primary" onclick="fetchJobListings()">Search</button>
                </div>
            </div>
        </div>
        <!-- Resume box -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
        <div class="mb-4">
            <label for="resume-upload">Upload your resume (.docx format) or <a href="#" id="toggle-textarea">manually
                    enter
                </a>:</label>
            <input id="upload" type="file" />
            <textarea class="form-control mt-2" id="resume-text" rows="10" style="display: none;"></textarea>
            <script>
                document.getElementById('toggle-textarea').addEventListener('click', function (e) {
                    e.preventDefault();
                    var textarea = document.getElementById('resume-text');
                    if (textarea.style.display === 'none') {
                        textarea.style.display = 'block';
                    } else {
                        textarea.style.display = 'none';
                    }
                });

                document.getElementById('upload').addEventListener('change', function (event) {
                    var reader = new FileReader();
                    reader.onload = function (event) {
                        mammoth.extractRawText({ arrayBuffer: event.target.result })
                            .then(displayResult)
                            .catch(handleError);
                    };
                    reader.readAsArrayBuffer(this.files[0]);
                }, false);

                function displayResult(result) {
                    document.getElementById('resume-text').value = result.value;
                }

                function handleError(err) {
                    console.log(err);
                    alert('Error processing document.');
                }
            </script>
            <div id="loading-overlay"
                style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
                <div
                    style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0,0,0,0.5);">
                    Hold please. Doing AI things. Your generated content will be available at the top of the page
                    when
                    I'm
                    finished.
                </div>
            </div>
            <div class="pro-tip-box">
                Pro-tip: ATS systems prefer minimal formatting, plain text, and standard date formats. Include as many
                keywords as possible. Our ATS Optimizer handles
                all of this
                for you. Check it out by clicking the ✨ATS Optimized Resume button within any job posting or try out our
                Resume Scanner if you just want to know how ATS friendly your resume is by clicking
                <a href="/resume-enhancer" style="color: rgb(0, 174, 41);">HERE!</a>
            </div>


            <!-- Generated Resume Display -->
            <div class="cover-letter-section" id="cover-letter-section-1" style="display: none;">
                <h3
                    style="text-align: center !important; color: #007BFF !important; font-family: 'Crimson Text', serif !important;">
                    Optimized Resume</h3>
                <textarea class="form-control" id="cover-letter-text-1" readonly="" rows="10"></textarea>
                <!-- New buttons added here -->
                <div class="mt-2">
                    <button class="btn btn-primary mt-2" id="download-resume-1" onclick="downloadResume_1()">⬇️ Download
                        (.TXT)</button>
                    <button class="btn btn-secondary mt-2 ml-2" id="copy-resume-1" onclick="copyToClipboard_1()">📋 Copy
                        to Clipboard</button>
                    <button class="btn btn-primary mt-2 ml-2" onclick="saveResume()">💾 Save to Dashboard (.DOCX &
                        .PDF)</button>
                </div>
            </div>
             

            <!-- Generated Cover Letter Display -->
            <div class="mb-4" id="cover-letter-section" style="display: none;">
                <h3
                    style="text-align: center !important; color: #007BFF !important; font-family: 'Crimson Text', serif !important;">
                    AI Generated Cover Letter</h3>
                <textarea class="form-control" id="cover-letter-text" readonly="" rows="10"></textarea>
                <div class="mt-2">
                    <button class="btn btn-success" onclick="downloadCoverLetter()">⬇️ Download (.TXT)</button>
                    <button class="btn btn-info" onclick="copyToClipboard()">📋 Copy to Clipboard</button><button
                        class="btn btn-primary mt-2 ml-2" onclick="saveDocument()">💾 Save to Dashboard (.DOCX &
                        .PDF)</button>
                </div>
            </div>
            <!-- Job Listings Container -->
            <div class="mb-4" id="job-listings-container">
                <!-- Job listings will be populated here -->
            </div>
            <script>
                var userId = {{ user_id }};
            </script>
            <script>

                function generateCoverLetter_1(jobDescription, resume, jobTitle, companyName, applyLink) { // Add applyLink parameter
                    console.log("Job Description:", jobDescription);
                    console.log("Resume:", resume);

                    // Show the loading overlay
                    document.getElementById('loading-overlay').style.display = 'block';

                    // Make a POST request to the backend with the required data
                    fetch('/resume.1', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            resume: resume,
                            job_description: jobDescription,
                            job_title: jobTitle
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log("Cover Letter Response:", data);

                            // Hide the loading overlay
                            document.getElementById('loading-overlay').style.display = 'none';

                            // Store the job details in data attributes on the text box element
                            var textBox = document.getElementById('cover-letter-text-1');
                            textBox.value = data.cover_letter;
                            textBox.setAttribute('data-job-title', jobTitle);
                            textBox.setAttribute('data-company-name', companyName);
                            textBox.setAttribute('data-apply-link', applyLink); // Store the apply link

                            document.getElementById('cover-letter-section-1').style.display = 'block';
                        })
                        .catch(error => {
                            console.error("Error generating cover letter:", error);

                            // Hide the loading overlay even in case of error
                            document.getElementById('loading-overlay').style.display = 'none';
                        });
                }



                function generateCoverLetter(jobDescription, resume, jobTitle, companyName, applyLink) { // Add applyLink parameter
                    console.log("Generate Cover Letter button clicked.");
                    console.log("Job Description:", jobDescription);
                    console.log("Resume:", resume);

                    // Show the loading overlay
                    document.getElementById('loading-overlay').style.display = 'block';

                    // Make an AJAX call to the Flask backend
                    fetch('/career_click', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            resume: resume,
                            job_description: jobDescription,
                            company_name: companyName,
                            job_title: jobTitle
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log("Cover Letter Response:", data);

                            // Hide the loading overlay
                            document.getElementById('loading-overlay').style.display = 'none';

                            // Store the job details in data attributes on the text box element
                            var textBox = document.getElementById('cover-letter-text');
                            textBox.value = data.cover_letter;
                            textBox.setAttribute('data-job-title', jobTitle);
                            textBox.setAttribute('data-company-name', companyName);
                            textBox.setAttribute('data-apply-link', applyLink); // Store the apply link

                            document.getElementById('cover-letter-section').style.display = 'block';
                        })
                        .catch(error => {
                            console.error('Error generating cover letter:', error);

                            // Hide the loading overlay even in case of error
                            document.getElementById('loading-overlay').style.display = 'none';
                        });
                }



                // Fetch job listings based on user input
                function fetchJobListings() {
                    const jobQuery = document.getElementById('job-query').value;
                    const jobLocation = document.getElementById('job-location').value;

                    const requestData = {
                        query: jobQuery,
                        location: jobLocation
                    };

                    fetch('/fetch-job-listings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestData)
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log("Jobs Array:", data.data);  // Log the jobs array
                            if (data.data) {
                                displayJobListings({ jobs: data.data }); // Adjusting the data structure
                            } else {
                                console.error("No jobs found or unexpected data structure:", data);
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching job listings:', error);
                        });
                }

                function displayJobListings(response) {
                    const jobs = response.jobs;
                    const listingsContainer = document.getElementById('job-listings-container');
                    listingsContainer.innerHTML = '';  // Clear any previous listings

                    jobs.forEach(job => {
                        const jobBox = document.createElement('div');
                        jobBox.className = 'job-box';
                        jobBox.style.marginBottom = '50px';
                        jobBox.style.position = 'relative';
                        jobBox.style.borderRadius = '10px'; // Adjust this value as needed

                        // Add the job identifier as a data attribute to the job box
                        jobBox.dataset.jobIdentifier = job.job_id;

                        // Append the employer logo if it exists
                        if (job.employer_logo) {
                            const logoImg = document.createElement('img');
                            logoImg.src = job.employer_logo;
                            logoImg.alt = job.employer_name + ' logo';
                            logoImg.style.width = '75px'; // Adjust this to your preferred size
                            jobBox.appendChild(logoImg);
                        }
                        // Append the job posted timestamp
                        const jobPostedTimestamp = document.createElement('p');
                        const dateObj = new Date(job.job_posted_at_timestamp * 1000); // Convert to milliseconds
                        jobPostedTimestamp.innerText = 'Posted At: ' + dateObj.toDateString();
                        jobPostedTimestamp.style.fontSize = '12px';  // You can adjust '12px' to your preferred size
                        jobBox.appendChild(jobPostedTimestamp);


                        // Create the "Save Job" heart-shaped button
                        const saveJobButton = document.createElement('i');
                        saveJobButton.className = 'fa fa-heart save-job-btn';
                        saveJobButton.dataset.jobId = job.job_id;
                        saveJobButton.style.cursor = 'pointer';
                        saveJobButton.style.marginRight = '10px';  // Adjusted the margin property name
                        saveJobButton.style.fontSize = '24px';

                        saveJobButton.onclick = function () {
                            if (!this.classList.contains('saved')) {
                                this.classList.add('saved');
                                this.style.color = 'red';

                                // Capture job details
                                const jobDetails = {
                                    job_id: job.job_id,
                                    job_title: job.job_title,
                                    job_description: job.job_description,
                                    job_link: job.job_apply_link,
                                    job_loc: '',  // You might need to capture this if available in your job object
                                    company_name: job.employer_name || "Unknown Company",
                                    link: '',  // You might need to capture this if available in your job object
                                    employer_logo: job.employer_logo || ""  // Capture the employer logo URL
                                };

                                // Send job details to backend using AJAX
                                $.ajax({
                                    url: "/save-job",
                                    type: "POST",
                                    contentType: "application/json",  // Set the Content-Type header
                                    data: JSON.stringify(jobDetails),
                                    success: function (response) {
                                        if (response.success) {
                                            console.log("Job saved successfully!");
                                        } else {
                                            alert("You must be logged in to Save Jobs to your Dashboard.");
                                        }
                                    },
                                    error: function (xhr, status, error) {
                                        console.error("Failed to save job:", error);
                                    }
                                });

                            } else {
                                this.classList.remove('saved');
                                this.style.color = '';
                                // TODO: Optionally send a request to backend to unsave the job
                            }
                        };

                        jobBox.appendChild(saveJobButton);

                        const analyzeSymbol = document.createElement('a');
                        analyzeSymbol.href = '#';  // Prevent default navigation
                        analyzeSymbol.innerText = '$';
                        analyzeSymbol.style.color = 'green';  // Give it the color green
                        analyzeSymbol.style.fontSize = '30px';  // Adjust size as needed
                        analyzeSymbol.style.marginLeft = '5px';  // Provide some margin for better spacing
                        analyzeSymbol.style.marginRight = '10px';  // Provide some margin for better spacing
                        analyzeSymbol.style.cursor = 'pointer';  // Change cursor to pointer to indicate clickability
                        analyzeSymbol.style.fontWeight = 'bold';  // Make the symbol bold
                        analyzeSymbol.onclick = (event) => {
                            event.preventDefault();  // Prevent default navigation
                            // AJAX call to Flask backend with separate parameters for job title
                            $.post("/analyze-job", {
                                job_title: job.job_title
                            }, function (data) {
                                // Display the result in the modal
                                document.getElementById('analyzeResult').innerText = data.response;
                                $('#analyzeModal').modal('show');
                            });
                        };
                        jobBox.appendChild(analyzeSymbol);

                        // Append the Apply button
                        const applyButton = document.createElement('a');
                        applyButton.href = job.job_apply_link;
                        applyButton.target = '_blank';
                        applyButton.className = 'btn btn-primary job-box-btn';
                        applyButton.innerText = 'Apply!';
                        applyButton.style.marginBottom = '10px';
                        applyButton.style.marginLeft = '8px';
                        jobBox.appendChild(applyButton);


                        // Append the job title
                        const jobTitle = document.createElement('h4');
                        jobTitle.innerText = (job.job_title || 'N/A');
                        jobTitle.style.color = '#black';
                        jobBox.appendChild(jobTitle);

                        // Append the employer name
                        const employerName = document.createElement('p');
                        employerName.innerText = (job.employer_name || 'N/A');
                        employerName.style.color = '#007BFF';
                        jobBox.appendChild(employerName);

                        // Create the "Generate Cover Letter" button first
                        const generateButton = document.createElement('button');
                        generateButton.className = 'btn btn-secondary ml-2 job-box-btn';
                        generateButton.innerText = '✨AI Cover Letter'; // Added paper and pencil emojis here
                        generateButton.style.backgroundColor = '#99ff99';
                        generateButton.style.color = 'black';
                        generateButton.style.marginBottom = '10px';
                        generateButton.style.marginLeft = '20px';
                        generateButton.onclick = () => generateCoverLetter(
                            job.job_description,
                            document.getElementById('resume-text').value,
                            job.job_title,
                            job.employer_name || "Unknown Company",
                            job.job_apply_link // Include the apply link
                        );
                        jobBox.appendChild(generateButton);


                        // Create the "Generate Cover Letter (Resume.1)" button
                        const generateButton_1 = document.createElement('button');
                        generateButton_1.className = 'btn btn-secondary ml-2 job-box-btn';
                        generateButton_1.innerText = '✨ATS Optimized Resume';
                        generateButton_1.style.backgroundColor = '#99ff99';
                        generateButton_1.style.color = 'black';
                        generateButton_1.style.marginBottom = '10px';
                        generateButton_1.onclick = () => generateCoverLetter_1(
                            job.job_description,
                            document.getElementById('resume-text').value,
                            job.job_title,
                            job.employer_name || "Unknown Company",
                            job.job_apply_link // Include the apply link
                        );
                        jobBox.appendChild(generateButton_1);


                        // Append the remote status
                        const jobRemoteStatus = document.createElement('p');
                        jobRemoteStatus.innerText = 'Remote: ' + (job.job_is_remote ? 'Yes' : 'No');
                        jobBox.appendChild(jobRemoteStatus);

                        // Append the job employment type
                        const jobEmploymentType = document.createElement('p');
                        jobEmploymentType.innerText = 'Employment Type: ' + (job.job_employment_type || 'N/A');
                        jobBox.appendChild(jobEmploymentType);

                        // Append the job description
                        const jobDescription = document.createElement('p');
                        jobDescription.innerText = 'Description: ' + (job.job_description || 'N/A');
                        jobBox.appendChild(jobDescription);

                        // Append the job publisher
                        const jobPublisher = document.createElement('p');
                        jobPublisher.innerText = 'Publisher: ' + (job.job_publisher || 'N/A');
                        jobBox.appendChild(jobPublisher);

                        // Append the apply link
                        const applyLink = document.createElement('a');
                        applyLink.href = job.job_apply_link;
                        applyLink.innerText = 'Apply Here';
                        applyLink.target = '_blank';
                        jobBox.appendChild(applyLink);

                        // Append the job ID
                        const jobId = document.createElement('p');
                        jobId.innerText = 'Job ID: ' + (job.job_id || 'N/A');
                        jobBox.appendChild(jobId);



                        listingsContainer.appendChild(jobBox);
                    });

                    // When a jobBox or any of its children are clicked, toggle its active state and adjust overflow
                    document.addEventListener('click', function (event) {
                        // Deactivate all active job boxes first
                        document.querySelectorAll('.job-box.active').forEach(function (box) {
                            box.classList.remove('active');
                            box.style.overflow = 'hidden';
                        });

                        // Find the closest .job-box to the clicked element
                        let closestJobBox = event.target.closest('.job-box');

                        if (closestJobBox) {
                            closestJobBox.classList.add('active');
                            closestJobBox.style.overflow = 'auto';
                        }
                    });
                }


                // Download the generated cover letter as a .txt file
                function downloadCoverLetter() {
                    const coverLetter = document.getElementById('cover-letter-text').value;
                    const blob = new Blob([coverLetter], { type: 'text/plain' });
                    const a = document.createElement('a');
                    a.download = 'cover_letter.txt';
                    a.href = URL.createObjectURL(blob);
                    a.click();
                }

                // Copy the generated cover letter to the clipboard
                function copyToClipboard() {
                    const coverLetterTextarea = document.getElementById('cover-letter-text');
                    coverLetterTextarea.select();
                    document.execCommand('copy');
                    alert('AI Cover letter copied to clipboard!');
                }

                // Function to download the resuME
                function downloadResume_1() {
                    const textToSave = document.getElementById('cover-letter-text-1').value;
                    const blob = new Blob([textToSave], { type: "text/plain" });
                    const anchor = document.createElement("a");
                    anchor.download = "resume_1.txt";
                    anchor.href = window.URL.createObjectURL(blob);
                    anchor.target = "_blank";
                    anchor.click();
                }

                // Function to copy the resuME to clipboard
                function copyToClipboard_1() {
                    const copyText = document.getElementById('cover-letter-text-1');
                    copyText.select();
                    document.execCommand("copy");
                    alert("Optimized Resume copied to clipboard!");
                }

                // Event listener for file upload
                $("#resume-upload").change(function () {
                    var form_data = new FormData();
                    var file_data = $("#resume-upload")[0].files[0];
                    form_data.append("file", file_data);

                    $.ajax({
                        type: "POST",
                        url: "/upload-search",
                        data: form_data,
                        contentType: false,
                        cache: false,
                        processData: false,
                        success: function (data) {
                            // Check if data is a string (error message) or an object (JSON response)
                            if (typeof data === 'string') {
                                // Display error message in the console
                                console.error(data);
                                // Show the error message to the user (You can use an alert or other UI element)
                                alert(data);
                            } else {
                                // Data is an object (JSON response) with a 'content' property
                                console.log(data.content);
                                // Set the content in the existing text area (resume)
                                $("#resume-text").val(data.content);

                                // Show the existing text area
                                $("#resume-upload").show();
                            }
                        },
                        error: function (xhr, textStatus, error) {
                            console.error("Error while uploading the file:", error);
                            alert("An error occurred while uploading the file. Please try again later.");
                        }
                    });
                });

            </script>
        </div>
        <script>
            $(document).ready(function () {
                $(".job-box").click(function () {
                    // Display the entire content in an alert for now
                    // You can replace this with a modal or another method of your choice
                    alert($(this).text());
                });
            });


        </script>

        <div aria-hidden="true" aria-labelledby="analyzeModalLabel" class="modal fade" id="analyzeModal" role="dialog"
            tabindex="-1">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="analyzeModalLabel">Salary Range:</h5>
                        <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p id="analyzeResult"></p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            var userId = {{ user_id }};
        </script>
        <script>
            function saveDocument() {
                const textBox = document.getElementById('cover-letter-text');
                const documentContent = textBox.value;
                const documentName = "Cover Letter (Job Search)";
                const documentType = "Cover Letter (Job Search)";
                const jobTitle = textBox.getAttribute('data-job-title');
                const companyName = textBox.getAttribute('data-company-name');
                const applyLink = textBox.getAttribute('data-apply-link');

                fetch("/save_document", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        document_name: documentName,
                        document_content: documentContent,
                        document_type: documentType,
                        job_title: jobTitle,
                        company_name: companyName,
                        apply_link: applyLink
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.message === "Document saved successfully. You may view your Saved Documents on your Dashboard") {
                            alert("Cover Letter saved successfully! You may view and download your Saved Documents from your Dashboard");
                        } else {
                            alert("You must be logged in to access your Dashboard.");
                        }
                    });
            }

            function saveResume() {
                const textBox = document.getElementById('cover-letter-text-1');
                const resumeContent = textBox.value;
                const resumeName = "ATS Enhanced Resume (Job Search)";
                const documentType = "ATS Enhanced Resume (Job Search)";
                const jobTitle = textBox.getAttribute('data-job-title');
                const companyName = textBox.getAttribute('data-company-name');
                const applyLink = textBox.getAttribute('data-apply-link');

                fetch("/save_document", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        document_name: resumeName,
                        document_content: resumeContent,
                        document_type: documentType,
                        job_title: jobTitle,
                        company_name: companyName,
                        apply_link: applyLink
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.message === "Document saved successfully. You may view your Saved Documents on your Dashboard") {
                            alert("Resume saved successfully! You may view and download your Saved Documents from your Dashboard");
                        } else {
                            alert("You must be logged in to access your Dashboard.");
                        }
                    });
            }


        </script>
    </div>

    <script>
        console.log("jQuery version:", $().jquery);
        console.log("Bootstrap:", typeof ($.fn.modal));
    </script>

</body>

<script>
    console.log("jQuery version:", $().jquery);
    console.log("Bootstrap:", typeof ($.fn.modal));
</script>

</body>

</html>